function FOSSGISOSRMEngine(t,e){var n=[];return{id:t,creditline:'<a href="https://routing.openstreetmap.de/about.html" target="_blank">OSRM (FOSSGIS)</a>',draggable:!0,_transformSteps:function(t,e){var n={continue:"javascripts.directions.instructions.continue","merge right":"javascripts.directions.instructions.merge_right","merge left":"javascripts.directions.instructions.merge_left","off ramp right":"javascripts.directions.instructions.offramp_right","off ramp left":"javascripts.directions.instructions.offramp_left","on ramp right":"javascripts.directions.instructions.onramp_right","on ramp left":"javascripts.directions.instructions.onramp_left","fork right":"javascripts.directions.instructions.fork_right","fork left":"javascripts.directions.instructions.fork_left","end of road right":"javascripts.directions.instructions.endofroad_right","end of road left":"javascripts.directions.instructions.endofroad_left","turn straight":"javascripts.directions.instructions.continue","turn slight right":"javascripts.directions.instructions.slight_right","turn right":"javascripts.directions.instructions.turn_right","turn sharp right":"javascripts.directions.instructions.sharp_right","turn uturn":"javascripts.directions.instructions.uturn","turn sharp left":"javascripts.directions.instructions.sharp_left","turn left":"javascripts.directions.instructions.turn_left","turn slight left":"javascripts.directions.instructions.slight_left",roundabout:"javascripts.directions.instructions.roundabout",rotary:"javascripts.directions.instructions.roundabout","exit roundabout":"javascripts.directions.instructions.exit_roundabout","exit rotary":"javascripts.directions.instructions.exit_roundabout",depart:"javascripts.directions.instructions.start",arrive:"javascripts.directions.instructions.destination"},o={continue:0,"merge right":21,"merge left":20,"off ramp right":24,"off ramp left":25,"on ramp right":2,"on ramp left":6,"fork right":18,"fork left":19,"end of road right":22,"end of road left":23,"turn straight":0,"turn slight right":1,"turn right":2,"turn sharp right":3,"turn uturn":4,"turn slight left":5,"turn left":6,"turn sharp left":7,roundabout:10,rotary:10,"exit roundabout":10,"exit rotary":10,depart:8,arrive:14},r=function(t){return["first","second","third","fourth","fifth","sixth","seventh","eighth","ninth","tenth"][t-1]};return t.map((function(t,i){var a;switch(t.maneuver.type){case"on ramp":case"off ramp":case"merge":case"end of road":case"fork":a=t.maneuver.type+" "+(t.maneuver.modifier.indexOf("left")>=0?"left":"right");break;case"depart":case"arrive":case"roundabout":case"rotary":case"exit roundabout":case"exit rotary":a=t.maneuver.type;break;default:a="turn "+t.maneuver.modifier}var s=n[a],c=L.PolylineUtil.decode(t.geometry,{precision:5}).map((function(t){return L.latLng(t)}));Array.prototype.push.apply(e,c);var l,u="<b>"+(i+1)+".</b> ",p="<b>"+t.destinations+"</b>",d=!0;if(t.name&&t.ref?l="<b>"+t.name+" ("+t.ref+")</b>":t.name?l="<b>"+t.name+"</b>":t.ref?l="<b>"+t.ref+"</b>":(l=I18n.t("javascripts.directions.instructions.unnamed"),d=!1),t.maneuver.type.match(/^exit (rotary|roundabout)$/))u+=I18n.t(s,{name:l});else if(t.maneuver.type.match(/^(rotary|roundabout)$/))t.maneuver.exit?t.maneuver.exit<=10?u+=I18n.t(s+"_with_exit_ordinal",{exit:I18n.t("javascripts.directions.instructions.exit_counts."+r(t.maneuver.exit)),name:l}):u+=I18n.t(s+"_with_exit",{exit:t.maneuver.exit,name:l}):u+=I18n.t(s+"_without_exit",{name:l});else if(t.maneuver.type.match(/^(on ramp|off ramp)$/)){var f={};t.exits&&t.maneuver.type.match(/^(off ramp)$/)&&(f.exit=t.exits),t.destinations&&(f.directions=p),d&&(f.directions=l),Object.keys(f).length>0&&(s=s+"_with_"+Object.keys(f).join("_")),u+=I18n.t(s,f)}else u+=I18n.t(s+"_without_exit",{name:l});return[[t.maneuver.location[1],t.maneuver.location[0]],o[a],u,t.distance,c]}))},getRoute:function(t,o){var r=[{name:"overview",value:"false"},{name:"geometries",value:"polyline"},{name:"steps",value:!0}];n.length===t.length?r.push({name:"hints",value:n.join(";")}):n=[];var i=t.map((function(t){return t.lng+","+t.lat})).join(";"),a=OSM.FOSSGIS_OSRM_URL+"routed-"+e+"/route/v1/driving/"+i,s=function(t){if("Ok"!==t.code)return o(!0);n=t.waypoints.map((function(t){return t.hint}));var e=[],r=function(t){return this._transformSteps(t.steps,e)},i=[].concat.apply([],t.routes[0].legs.map(r.bind(this)));o(!1,{line:e,steps:i,distance:t.routes[0].distance,time:t.routes[0].duration})};return $.ajax({url:a,data:r,dataType:"json",success:s.bind(this),error:function(){o(!0)}})}}}function FOSSGISValhallaEngine(t,e){var n=[0,8,8,8,14,14,14,0,0,1,2,3,4,4,7,6,5,0,24,25,24,25,0,1,5,20,10,11,17,0,null,null,null,null,null,null,null,21,20];return{id:t,creditline:"<a href='https://gis-ops.com/global-open-valhalla-server-online/' target='_blank'>Valhalla (FOSSGIS)</a>",draggable:!1,getRoute:function(t,o){return $.ajax({url:OSM.FOSSGIS_VALHALLA_URL,data:{json:JSON.stringify({locations:t.map((function(t){return{lat:t.lat,lon:t.lng}})),costing:e,directions_options:{units:"km",language:I18n.currentLocale()}})},dataType:"json",success:function(t){var e=t.trip;if(0===e.status){var r=[],i=[],a=0,s=0;e.legs.forEach((function(t){var e=L.PolylineUtil.decode(t.shape,{precision:6});r=r.concat(e),t.maneuvers.forEach((function(t,o){var r=e[t.begin_shape_index];i.push([{lat:r[0],lng:r[1]},n[t.type],"<b>"+(o+1)+".</b> "+t.instruction,1e3*t.length,[]])})),a+=t.summary.length,s+=t.summary.time})),o(!1,{line:r,steps:i,distance:1e3*a,time:s})}else o(!0)},error:function(){o(!0)}})}}}function GraphHopperEngine(t,e){var n={"-3":7,"-2":6,"-1":5,0:0,1:1,2:2,3:3,4:14,5:14,6:10};return{id:t,creditline:'<a href="https://www.graphhopper.com/" target="_blank">GraphHopper</a>',draggable:!1,getRoute:function(t,o){return $.ajax({url:OSM.GRAPHHOPPER_URL,data:{vehicle:e,locale:I18n.currentLocale(),key:"LijBPDQGfu7Iiq80w3HzwB4RUDJbMbhs6BU0dEnn",elevation:!1,instructions:!0,turn_costs:"car"===e,point:t.map((function(t){return t.lat+","+t.lng}))},traditional:!0,dataType:"json",success:function(t){if(!t.paths||0===t.paths.length)return o(!0);for(var e=t.paths[0],r=L.PolylineUtil.decode(e.points),i=[],a=e.instructions.length,s=0;s<a;s++){var c=e.instructions[s],l=s===a-1?14:n[c.sign],u="<b>"+(s+1)+".</b> ";u+=c.text;for(var p=r[c.interval[0]],d=c.distance,f=[],h=c.interval[0];h<=c.interval[1];h++)f.push({lat:r[h][0],lng:r[h][1]});i.push([{lat:p[0],lng:p[1]},l,u,d,f])}o(!1,{line:r,steps:i,distance:e.distance,time:e.time/1e3,ascend:e.ascend,descend:e.descend})},error:function(){o(!0)}})}}}$(document).ready((function(){function t(t){t.forEach((function(t){t.addTo(o)}));var e=t[0].getContainer();$(e).find(".control-button").first().addClass("control-button-first");var n=t[t.length-1].getContainer();$(n).find(".control-button").last().addClass("control-button-last")}function e(t,e){function n(t,e){var n=$("<iframe>"),o=setTimeout((function(){alert(I18n.t("site.index.remote_failed")),n.remove()}),5e3);n.hide().appendTo("body").attr("src",t).on("load",(function(){clearTimeout(o),n.remove(),e&&e()}))}var o="http://127.0.0.1:8111",r=location.protocol+"//"+location.host,i={left:t.getWest()-1e-4,top:t.getNorth()+1e-4,right:t.getEast()+1e-4,bottom:t.getSouth()-1e-4};return e&&"note"!==e.type&&(i.select=e.type+e.id),n(o+"/load_and_zoom?"+Qs.stringify(i),(function(){if(e&&"note"===e.type){var t={url:r+OSM.apiUrl(e)};n(o+"/import?"+Qs.stringify(t))}})),!1}var n,o=new L.OSM.Map("map",{zoomControl:!1,layerControl:!1,contextmenu:!0,worldCopyJump:!0});OSM.loadSidebarContent=function(t,e){var r=t;o.setSidebarOverlaid(!1),clearTimeout(n),n=setTimeout((function(){$("#sidebar_loader").show()}),200),r.indexOf("?")>=0?r+="&xhr=1":r+="?xhr=1",$("#sidebar_content").empty(),$.ajax({url:r,dataType:"html",complete:function(t){clearTimeout(n),$("#flash").empty(),$("#sidebar_loader").hide();var o=$(t.responseText);if(t.getResponseHeader("X-Page-Title")){var r=t.getResponseHeader("X-Page-Title");document.title=decodeURIComponent(r)}$("head").find('link[type="application/atom+xml"]').remove(),$("head").append(o.filter('link[type="application/atom+xml"]')),$("#sidebar_content").html(o.not('link[type="application/atom+xml"]')),e&&e()}})};var r=OSM.mapParams();o.attributionControl.setPrefix(""),o.updateLayers(r.layers),o.on("baselayerchange",(function(t){o.getZoom()>t.layer.options.maxZoom&&o.setView(o.getCenter(),t.layer.options.maxZoom,{reset:!0})}));var i=L.OSM.sidebar("#map-ui").addTo(o),a="rtl"===$("html").attr("dir")?"topleft":"topright";t([L.OSM.zoom({position:a}),L.OSM.locate({position:a})]),t([L.OSM.layers({position:a,layers:o.baseLayers,sidebar:i}),L.OSM.key({position:a,sidebar:i}),L.OSM.share({position:a,sidebar:i,short:!0})]),t([L.OSM.note({position:a,sidebar:i})]),t([L.OSM.query({position:a,sidebar:i})]),L.control.scale().addTo(o),OSM.initializeContextMenu(o),"api_offline"!==OSM.STATUS&&"database_offline"!==OSM.STATUS&&(OSM.initializeNotes(o),r.layers.indexOf(o.noteLayer.options.code)>=0&&o.addLayer(o.noteLayer),OSM.initializeBrowse(o),r.layers.indexOf(o.dataLayer.options.code)>=0&&o.addLayer(o.dataLayer),r.layers.indexOf(o.gpsLayer.options.code)>=0&&o.addLayer(o.gpsLayer));var s="rtl"===$("html").attr("dir")?"right":"left";$(".leaflet-control .control-button").tooltip({placement:s,container:"body"});var c=new Date;c.setYear(c.getFullYear()+10),o.on("moveend layeradd layerremove",(function(){updateLinks(o.getCenter().wrap(),o.getZoom(),o.getLayersCode(),o._object),Cookies.set("_osm_location",OSM.locationCookie(o),{secure:!0,expires:c,path:"/",samesite:"lax"})})),"hide"!==Cookies.get("_osm_welcome")&&$(".welcome").addClass("visible"),$(".welcome .btn-close").on("click",(function(){$(".welcome").removeClass("visible"),Cookies.set("_osm_welcome","hide",{secure:!0,expires:c,path:"/",samesite:"lax"})}));var l=new Date;l.setYear(l.getFullYear()+1),$("#banner .btn-close").on("click",(function(t){var e=t.target.id;$("#banner").hide(),t.preventDefault(),e&&Cookies.set(e,"hide",{secure:!0,expires:l,path:"/",samesite:"lax"})})),OSM.MATOMO&&o.on("layeradd",(function(t){if(t.layer.options){var e=OSM.MATOMO.goals[t.layer.options.keyid];e&&$("body").trigger("matomogoal",e)}})),r.bounds?o.fitBounds(r.bounds):o.setView([r.lat,r.lon],r.zoom),r.marker&&L.marker([r.mlat,r.mlon]).addTo(o),$("#homeanchor").on("click",(function(t){t.preventDefault();var e=$(this).data(),n=L.latLng(e.lat,e.lon);o.setView(n,e.zoom),L.marker(n,{icon:OSM.getUserIcon()}).addTo(o)})),$("a[data-editor=remote]").click((function(t){var n=OSM.mapParams(this.search);e(o.getBounds(),n.object),t.preventDefault()})),OSM.params().edit_help&&($("#editanchor").removeAttr("title").tooltip({placement:"bottom",title:I18n.t("javascripts.edit_help")}).tooltip("show"),$("body").one("click",(function(){$("#editanchor").tooltip("hide")}))),OSM.Index=function(t){var e={};return e.pushstate=e.popstate=function(){t.setSidebarOverlaid(!0),document.title=I18n.t("layouts.project_name.title")},e.load=function(){var e=Qs.parse(location.search.substring(1));return e.query&&$("#sidebar .search_form input[name=query]").value(e.query),"autofocus"in document.createElement("input")||$("#sidebar .search_form input[name=query]").focus(),t.getState()},e},OSM.Browse=function(t,e){function n(e,n,o){t.addObject({type:e,id:parseInt(n,10)},(function(e){window.location.hash||!e.isValid()||!o&&t.getBounds().contains(e)||OSM.router.withoutMoveListener((function(){t.fitBounds(e)}))})),$(".colour-preview-box").each((function(){$(this).css("background-color",$(this).data("colour"))}))}var o={};return o.pushstate=o.popstate=function(t,o){OSM.loadSidebarContent(t,(function(){n(e,o)}))},o.load=function(t,o){n(e,o,!0)},o.unload=function(){t.removeObject()},o};var u=OSM.History(o);OSM.router=OSM.Router(o,{"/":OSM.Index(o),"/search":OSM.Search(o),"/directions":OSM.Directions(o),"/export":OSM.Export(o),"/note/new":OSM.NewNote(o),"/history/friends":u,"/history/nearby":u,"/history":u,"/user/:display_name/history":u,"/note/:id":OSM.Note(o),"/node/:id(/history)":OSM.Browse(o,"node"),"/way/:id(/history)":OSM.Browse(o,"way"),"/relation/:id(/history)":OSM.Browse(o,"relation"),"/changeset/:id":OSM.Changeset(o),"/query":OSM.Query(o)}),"remote"===OSM.preferred_editor&&"/edit"===document.location.pathname&&(e(o.getBounds(),r.object),OSM.router.setCurrentPath("/")),OSM.router.load(),$(document).on("click","a",(function(t){t.isDefaultPrevented()||t.isPropagationStopped()||t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||location.protocol===this.protocol&&location.host===this.host&&OSM.router.route(this.pathname+this.search+this.hash)&&t.preventDefault()})),$(document).on("click","#sidebar_content .btn-close",(function(){OSM.router.route("/"+OSM.formatHash(o))}))})),L.OSM.sidebar=function(t){var e,n={},o=$(t),r=$(),i=$();return n.addTo=function(t){return e=t,n},n.addPane=function(t){t.hide().appendTo(o)},n.togglePane=function(t,n){var a=250;r.hide().trigger("hide"),i.removeClass("active"),r===t?("rtl"===$("html").attr("dir")&&e.panBy([-a,0],{animate:!1}),$(o).hide(),r=i=$()):($(o).show(),r=t,i=n||$(),"rtl"===$("html").attr("dir")&&e.panBy([a,0],{animate:!1})),e.invalidateSize({pan:!1,animate:!1}),r.show().trigger("show"),i.addClass("active")},n},L.OSM.sidebarPane=function(t,e,n,o){var r=L.control(t);return r.onAdd=function(r){function i(e){e.stopPropagation(),e.preventDefault(),s.hasClass("disabled")||t.sidebar.togglePane(c,s),$(".leaflet-control .control-button").tooltip("hide")}var a=$("<div>").attr("class","control-"+e),s=$("<a>").attr("class","control-button").attr("href","#").html('<span class="icon '+e+'"></span>').on("click",i);n&&s.attr("title",I18n.t(n)),s.appendTo(a);var c=$("<div>").attr("class",e+"-ui");return $("<div class='sidebar_heading d-flex'>").appendTo(c).append($("<h4 class='flex-grow-1 text-break'>").text(I18n.t(o))).append($("<div>").append($("<button type='button' class='btn-close'>").attr("aria-label",I18n.t("javascripts.close")).bind("click",i))),t.sidebar.addPane(c),this.onAddPane(r,s,c,i),a[0]},r},
/*!
Copyright (c) 2016 Dominik Moritz

This file is part of the leaflet locate control. It is licensed under the MIT license.
You can find the project at: https://github.com/domoritz/leaflet-locatecontrol
*/
function(t,e){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(void 0!==e&&e.L?module.exports=t(L):module.exports=t(require("leaflet"))),void 0!==e&&e.L&&(e.L.Control.Locate=t(L))}((function(t){const e=(e,n,o)=>{(o=o.split(" ")).forEach((function(o){t.DomUtil[e].call(this,n,o)}))},n=(t,n)=>e("addClass",t,n),o=(t,n)=>e("removeClass",t,n),r=t.Marker.extend({initialize(e,n){t.Util.setOptions(this,n),this._latlng=e,this.createIcon()},createIcon(){const e=this.options;let n="";void 0!==e.color&&(n+=`stroke:${e.color};`),void 0!==e.weight&&(n+=`stroke-width:${e.weight};`),void 0!==e.fillColor&&(n+=`fill:${e.fillColor};`),void 0!==e.fillOpacity&&(n+=`fill-opacity:${e.fillOpacity};`),void 0!==e.opacity&&(n+=`opacity:${e.opacity};`);const o=this._getIconSVG(e,n);this._locationIcon=t.divIcon({className:o.className,html:o.svg,iconSize:[o.w,o.h]}),this.setIcon(this._locationIcon)},_getIconSVG(t,e){const n=t.radius,o=n+t.weight,r=2*o;return{className:"leaflet-control-locate-location",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="${r}" height="${r}" version="1.1" viewBox="-${o} -${o} ${r} ${r}"><circle r="`+n+'" style="'+e+'" /></svg>',w:r,h:r}},setStyle(e){t.Util.setOptions(this,e),this.createIcon()}}),i=r.extend({initialize(e,n,o){t.Util.setOptions(this,o),this._latlng=e,this._heading=n,this.createIcon()},setHeading(t){this._heading=t},_getIconSVG(t,e){const n=t.radius,o=t.width+t.weight,r=2*(n+t.depth+t.weight),i=`M0,0 l${t.width/2},${t.depth} l-${o},0 z`;return{className:"leaflet-control-locate-heading",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="${o}" height="${r}" version="1.1" viewBox="-${o/2} 0 ${o} ${r}" style="${`transform: rotate(${this._heading}deg)`}"><path d="`+i+'" style="'+e+'" /></svg>',w:o,h:r}}}),a=t.Control.extend({options:{position:"topleft",layer:void 0,setView:"untilPanOrZoom",keepCurrentZoomLevel:!1,initialZoomLevel:!1,getLocationBounds:t=>t.bounds,flyTo:!1,clickBehavior:{inView:"stop",outOfView:"setView",inViewNotFollowing:"inView"},returnToPrevBounds:!1,cacheLocation:!0,drawCircle:!0,drawMarker:!0,showCompass:!0,markerClass:r,compassClass:i,circleStyle:{className:"leaflet-control-locate-circle",color:"#136AEC",fillColor:"#136AEC",fillOpacity:.15,weight:0},markerStyle:{className:"leaflet-control-locate-marker",color:"#fff",fillColor:"#2A93EE",fillOpacity:1,weight:3,opacity:1,radius:9},compassStyle:{fillColor:"#2A93EE",fillOpacity:1,weight:0,color:"#fff",opacity:1,radius:9,width:9,depth:6},followCircleStyle:{},followMarkerStyle:{},followCompassStyle:{},icon:"leaflet-control-locate-location-arrow",iconLoading:"leaflet-control-locate-spinner",iconElementTag:"span",textElementTag:"small",circlePadding:[0,0],metric:!0,createButtonCallback(e,n){const o=t.DomUtil.create("a","leaflet-bar-part leaflet-bar-part-single",e);o.title=n.strings.title,o.href="#",o.setAttribute("role","button");const r=t.DomUtil.create(n.iconElementTag,n.icon,o);if(void 0!==n.strings.text){t.DomUtil.create(n.textElementTag,"leaflet-locate-text",o).textContent=n.strings.text,o.classList.add("leaflet-locate-text-active"),o.parentNode.style.display="flex",n.icon.length>0&&r.classList.add("leaflet-locate-icon")}return{link:o,icon:r}},onLocationError(t,e){alert(t.message)},onLocationOutsideMapBounds(t){t.stop(),alert(t.options.strings.outsideMapBoundsMsg)},showPopup:!0,strings:{title:"Show me where I am",metersUnit:"meters",feetUnit:"feet",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:1/0,watch:!0,setView:!1}},initialize(e){for(const n in e)"object"==typeof this.options[n]?t.extend(this.options[n],e[n]):this.options[n]=e[n];this.options.followMarkerStyle=t.extend({},this.options.markerStyle,this.options.followMarkerStyle),this.options.followCircleStyle=t.extend({},this.options.circleStyle,this.options.followCircleStyle),this.options.followCompassStyle=t.extend({},this.options.compassStyle,this.options.followCompassStyle)},onAdd(e){const n=t.DomUtil.create("div","leaflet-control-locate leaflet-bar leaflet-control");this._container=n,this._map=e,this._layer=this.options.layer||new t.LayerGroup,this._layer.addTo(e),this._event=void 0,this._compassHeading=null,this._prevBounds=null;const o=this.options.createButtonCallback(n,this.options);return this._link=o.link,this._icon=o.icon,t.DomEvent.on(this._link,"click",(function(e){t.DomEvent.stopPropagation(e),t.DomEvent.preventDefault(e),this._onClick()}),this).on(this._link,"dblclick",t.DomEvent.stopPropagation),this._resetVariables(),this._map.on("unload",this._unload,this),n},_onClick(){this._justClicked=!0;const t=this._isFollowing();if(this._userPanned=!1,this._userZoomed=!1,this._active&&!this._event)this.stop();else if(this._active){const e=this.options.clickBehavior;let n=e.outOfView;switch(this._map.getBounds().contains(this._event.latlng)&&(n=t?e.inView:e.inViewNotFollowing),e[n]&&(n=e[n]),n){case"setView":this.setView();break;case"stop":if(this.stop(),this.options.returnToPrevBounds){(this.options.flyTo?this._map.flyToBounds:this._map.fitBounds).bind(this._map)(this._prevBounds)}}}else this.options.returnToPrevBounds&&(this._prevBounds=this._map.getBounds()),this.start();this._updateContainerStyle()},start(){this._activate(),this._event&&(this._drawMarker(this._map),this.options.setView&&this.setView()),this._updateContainerStyle()},stop(){this._deactivate(),this._cleanClasses(),this._resetVariables(),this._removeMarker()},stopFollowing(){this._userPanned=!0,this._updateContainerStyle(),this._drawMarker()},_activate(){if(!this._active&&this._map&&(this._map.locate(this.options.locateOptions),this._map.fire("locateactivate",this),this._active=!0,this._map.on("locationfound",this._onLocationFound,this),this._map.on("locationerror",this._onLocationError,this),this._map.on("dragstart",this._onDrag,this),this._map.on("zoomstart",this._onZoom,this),this._map.on("zoomend",this._onZoomEnd,this),this.options.showCompass)){const e="ondeviceorientationabsolute"in window;if(e||"ondeviceorientation"in window){const n=this,o=function(){t.DomEvent.on(window,e?"deviceorientationabsolute":"deviceorientation",n._onDeviceOrientation,n)};DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(t){"granted"===t&&o()})):o()}}},_deactivate(){this._active&&this._map&&(this._map.stopLocate(),this._map.fire("locatedeactivate",this),this._active=!1,this.options.cacheLocation||(this._event=void 0),this._map.off("locationfound",this._onLocationFound,this),this._map.off("locationerror",this._onLocationError,this),this._map.off("dragstart",this._onDrag,this),this._map.off("zoomstart",this._onZoom,this),this._map.off("zoomend",this._onZoomEnd,this),this.options.showCompass&&(this._compassHeading=null,"ondeviceorientationabsolute"in window?t.DomEvent.off(window,"deviceorientationabsolute",this._onDeviceOrientation,this):"ondeviceorientation"in window&&t.DomEvent.off(window,"deviceorientation",this._onDeviceOrientation,this)))},setView(){if(this._drawMarker(),this._isOutsideMapBounds())this._event=void 0,this.options.onLocationOutsideMapBounds(this);else if(this._justClicked&&!1!==this.options.initialZoomLevel)(e=this.options.flyTo?this._map.flyTo:this._map.setView).bind(this._map)([this._event.latitude,this._event.longitude],this.options.initialZoomLevel);else if(this.options.keepCurrentZoomLevel){(e=this.options.flyTo?this._map.flyTo:this._map.panTo).bind(this._map)([this._event.latitude,this._event.longitude])}else{var e=this.options.flyTo?this._map.flyToBounds:this._map.fitBounds;this._ignoreEvent=!0,e.bind(this._map)(this.options.getLocationBounds(this._event),{padding:this.options.circlePadding,maxZoom:this.options.initialZoomLevel||this.options.locateOptions.maxZoom}),t.Util.requestAnimFrame((function(){this._ignoreEvent=!1}),this)}},_drawCompass(){if(!this._event)return;const t=this._event.latlng;if(this.options.showCompass&&t&&null!==this._compassHeading){const e=this._isFollowing()?this.options.followCompassStyle:this.options.compassStyle;this._compass?(this._compass.setLatLng(t),this._compass.setHeading(this._compassHeading),this._compass.setStyle&&this._compass.setStyle(e)):this._compass=new this.options.compassClass(t,this._compassHeading,e).addTo(this._layer)}!this._compass||this.options.showCompass&&null!==this._compassHeading||(this._compass.removeFrom(this._layer),this._compass=null)},_drawMarker(){function e(){return"string"==typeof a?t.Util.template(a,{distance:r,unit:i}):"function"==typeof a?a({distance:r,unit:i}):a}void 0===this._event.accuracy&&(this._event.accuracy=0);const n=this._event.accuracy,o=this._event.latlng;if(this.options.drawCircle){const e=this._isFollowing()?this.options.followCircleStyle:this.options.circleStyle;this._circle?this._circle.setLatLng(o).setRadius(n).setStyle(e):this._circle=t.circle(o,n,e).addTo(this._layer)}let r,i;if(this.options.metric?(r=n.toFixed(0),i=this.options.strings.metersUnit):(r=(3.2808399*n).toFixed(0),i=this.options.strings.feetUnit),this.options.drawMarker){const t=this._isFollowing()?this.options.followMarkerStyle:this.options.markerStyle;this._marker?(this._marker.setLatLng(o),this._marker.setStyle&&this._marker.setStyle(t)):this._marker=new this.options.markerClass(o,t).addTo(this._layer)}this._drawCompass();const a=this.options.strings.popup;this.options.showPopup&&a&&this._marker&&this._marker.bindPopup(e())._popup.setLatLng(o),this.options.showPopup&&a&&this._compass&&this._compass.bindPopup(e())._popup.setLatLng(o)},_removeMarker(){this._layer.clearLayers(),this._marker=void 0,this._circle=void 0},_unload(){this.stop(),this._map.off("unload",this._unload,this)},_setCompassHeading(e){!isNaN(parseFloat(e))&&isFinite(e)?(e=Math.round(e),this._compassHeading=e,t.Util.requestAnimFrame(this._drawCompass,this)):this._compassHeading=null},_onCompassNeedsCalibration(){this._setCompassHeading()},_onDeviceOrientation(t){this._active&&(t.webkitCompassHeading?this._setCompassHeading(t.webkitCompassHeading):t.absolute&&t.alpha&&this._setCompassHeading(360-t.alpha))},_onLocationError(t){3==t.code&&this.options.locateOptions.watch||(this.stop(),this.options.onLocationError(t,this))},_onLocationFound(t){if((!this._event||this._event.latlng.lat!==t.latlng.lat||this._event.latlng.lng!==t.latlng.lng||this._event.accuracy!==t.accuracy)&&this._active){switch(this._event=t,this._drawMarker(),this._updateContainerStyle(),this.options.setView){case"once":this._justClicked&&this.setView();break;case"untilPan":this._userPanned||this.setView();break;case"untilPanOrZoom":this._userPanned||this._userZoomed||this.setView();break;case"always":this.setView()}this._justClicked=!1}},_onDrag(){this._event&&!this._ignoreEvent&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_onZoom(){this._event&&!this._ignoreEvent&&(this._userZoomed=!0,this._updateContainerStyle(),this._drawMarker())},_onZoomEnd(){this._event&&this._drawCompass(),this._event&&!this._ignoreEvent&&this._marker&&!this._map.getBounds().pad(-.3).contains(this._marker.getLatLng())&&(this._userPanned=!0,this._updateContainerStyle(),this._drawMarker())},_isFollowing(){return!!this._active&&("always"===this.options.setView||("untilPan"===this.options.setView?!this._userPanned:"untilPanOrZoom"===this.options.setView?!this._userPanned&&!this._userZoomed:void 0))},_isOutsideMapBounds(){return void 0!==this._event&&(this._map.options.maxBounds&&!this._map.options.maxBounds.contains(this._event.latlng))},_updateContainerStyle(){this._container&&(this._active&&!this._event?this._setClasses("requesting"):this._isFollowing()?this._setClasses("following"):this._active?this._setClasses("active"):this._cleanClasses())},_setClasses(t){"requesting"==t?(o(this._container,"active following"),n(this._container,"requesting"),o(this._icon,this.options.icon),n(this._icon,this.options.iconLoading)):"active"==t?(o(this._container,"requesting following"),n(this._container,"active"),o(this._icon,this.options.iconLoading),n(this._icon,this.options.icon)):"following"==t&&(o(this._container,"requesting"),n(this._container,"active following"),o(this._icon,this.options.iconLoading),n(this._icon,this.options.icon))},_cleanClasses(){t.DomUtil.removeClass(this._container,"requesting"),t.DomUtil.removeClass(this._container,"active"),t.DomUtil.removeClass(this._container,"following"),o(this._icon,this.options.iconLoading),n(this._icon,this.options.icon)},_resetVariables(){this._active=!1,this._justClicked=!1,this._userPanned=!1,this._userZoomed=!1}});return t.control.locate=e=>new t.Control.Locate(e),a}),window),L.OSM.locate=function(t){var e=L.control.locate(Object.assign({icon:"icon geolocate",iconLoading:"icon geolocate",strings:{title:I18n.t("javascripts.map.locate.title"),popup:function(t){return I18n.t("javascripts.map.locate."+t.unit+"Popup",{count:t.distance})}}},t));return e.onAdd=function(t){var e=Object.getPrototypeOf(this).onAdd.apply(this,[t]);return $(e).removeClass("leaflet-control-locate leaflet-bar").addClass("control-locate").children("a").attr("href","#").removeClass("leaflet-bar-part leaflet-bar-part-single").addClass("control-button"),e},e},L.OSM.layers=function(t){var e=L.OSM.sidebarPane(t,"layers","javascripts.map.layers.title","javascripts.map.layers.header");return e.onAddPane=function(e,n,o,r){var i=t.layers,a=$("<div>").attr("class","section base-layers").appendTo(o),s=$("<ul class='list-unstyled'>").appendTo(a);if(i.forEach((function(t){var n=$("<li>").appendTo(s);e.hasLayer(t)&&n.addClass("active");var a=$("<div>").appendTo(n);e.whenReady((function(){function n(){c.invalidateSize(),s({animate:!1}),e.on("moveend",i)}function r(){e.off("moveend",i)}function i(){s()}function s(t){c.setView(e.getCenter(),Math.max(e.getZoom()-2,0),t)}var c=L.map(a[0],{attributionControl:!1,zoomControl:!1,keyboard:!1}).addLayer(new t.constructor({apikey:t.options.apikey}));c.dragging.disable(),c.touchZoom.disable(),c.doubleClickZoom.disable(),c.scrollWheelZoom.disable(),o.on("show",n).on("hide",r)}));var c=$("<label>").appendTo(n),l=$("<input>").attr("type","radio").prop("checked",e.hasLayer(t)).appendTo(c);c.append(t.options.name),n.on("click",(function(){i.forEach((function(n){n===t?e.addLayer(n):e.removeLayer(n)})),e.fire("baselayerchange",{layer:t})})),n.on("dblclick",r),e.on("layeradd layerremove",(function(){n.toggleClass("active",e.hasLayer(t)),l.prop("checked",e.hasLayer(t))}))})),"api_offline"!==OSM.STATUS&&"database_offline"!==OSM.STATUS){var c=$("<div>").attr("class","section overlay-layers").appendTo(o);$("<p>").text(I18n.t("javascripts.map.layers.overlays")).attr("class","text-muted").appendTo(c);var l=$("<ul class='list-unstyled form-check'>").appendTo(c),u=function(t,n,o){var r=$("<li>").appendTo(l);"notes"!==n&&"data"!==n||r.attr("title",I18n.t("javascripts.site.map_"+n+"_zoom_in_tooltip")).tooltip("disable");var i=$("<label>").attr("class","form-check-label").appendTo(r),a=e.hasLayer(t),s=$("<input>").attr("type","checkbox").attr("class","form-check-input").prop("checked",a).appendTo(i);i.append(I18n.t("javascripts.map.layers."+n)),s.on("change",(function(){(a=s.is(":checked"))?e.addLayer(t):e.removeLayer(t),e.fire("overlaylayerchange",{layer:t})})),e.on("layeradd layerremove",(function(){s.prop("checked",e.hasLayer(t))})),e.on("zoomend",(function(){var t=e.getBounds().getSize()>=o;$(s).prop("disabled",t),t&&$(s).is(":checked")?($(s).prop("checked",!1).trigger("change"),a=!0):t||$(s).is(":checked")||!a||$(s).prop("checked",!0).trigger("change"),$(r).attr("class",t?"disabled":"").tooltip(t?"enable":"disable")}))};u(e.noteLayer,"notes",OSM.MAX_NOTE_REQUEST_AREA),u(e.dataLayer,"data",OSM.MAX_REQUEST_AREA),u(e.gpsLayer,"gps",Number.POSITIVE_INFINITY)}},e},L.OSM.key=function(t){var e=L.OSM.sidebarPane(t,"key",null,"javascripts.key.title");return e.onAddPane=function(t,e,n){function o(){t.on("zoomend baselayerchange",a),s.load("/key",a)}function r(){t.off("zoomend baselayerchange",a)}function i(){var n=-1===["mapnik","cyclemap"].indexOf(t.getMapBaseLayerId());e.toggleClass("disabled",n).attr("data-bs-original-title",I18n.t(n?"javascripts.key.tooltip_disabled":"javascripts.key.tooltip"))}function a(){var e=t.getMapBaseLayerId(),n=t.getZoom();$(".mapkey-table-entry").each((function(){var t=$(this).data();e===t.layer&&n>=t.zoomMin&&n<=t.zoomMax?$(this).show():$(this).hide()}))}var s=$("<div>").attr("class","section").appendTo(n);n.on("show",o).on("hide",r),t.on("baselayerchange",i),i()},e},L.OSM.note=function(t){var e=L.control(t);return e.onAdd=function(t){function e(){var e="database_offline"===OSM.STATUS||t.getZoom()<12;o.toggleClass("disabled",e).attr("data-bs-original-title",I18n.t(e?"javascripts.site.createnote_disabled_tooltip":"javascripts.site.createnote_tooltip"))}var n=$("<div>").attr("class","control-note"),o=$("<a>").attr("class","control-button").attr("href","#").html('<span class="icon note"></span>').appendTo(n);return t.on("zoomend",e),e(),n[0]},e},L.OSM.share=function(t){var e=L.OSM.sidebarPane(t,"share","javascripts.share.title","javascripts.share.title"),n=L.marker([0,0],{draggable:!0}),o=new L.LocationFilter({enableButton:!1,adjustButton:!1});return e.onAddPane=function(t,e,r){function i(){$("#mapnik_scale").val(m()),f()}function a(){t.removeLayer(n),t.options.scrollWheelZoom=t.options.doubleClickZoom=!0,o.disable(),f()}function s(){$(this).is(":checked")?(n.setLatLng(t.getCenter()),t.addLayer(n),t.options.scrollWheelZoom=t.options.doubleClickZoom="center"):(t.removeLayer(n),t.options.scrollWheelZoom=t.options.doubleClickZoom=!0),f()}function c(){$(this).is(":checked")?(o.setBounds(t.getBounds().pad(-.2)),o.enable()):o.disable(),f()}function l(){n.setLatLng(t.getCenter()),f()}function u(){t.hasLayer(n)&&(t.off("move",l),t.on("moveend",p),t.panTo(n.getLatLng()))}function p(){t.off("moveend",p),t.on("move",l),f()}function d(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};return null===t?"":String(t).replace(/[&<>"']/g,(function(t){return e[t]}))}function f(){var e=t.getBounds();$("#link_marker").prop("checked",t.hasLayer(n)),$("#image_filter").prop("checked",o.isEnabled()),$("#short_input").val(t.getShortUrl(n)),$("#long_input").val(t.getUrl(n)),$("#short_link").attr("href",t.getShortUrl(n)),$("#long_link").attr("href",t.getUrl(n));var r={bbox:e.toBBoxString(),layer:t.getMapBaseLayerId()};if(t.hasLayer(n)){var i=n.getLatLng().wrap();r.marker=i.lat+","+i.lng}$("#embed_html").val('<iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="'+d(OSM.SERVER_PROTOCOL+"://"+OSM.SERVER_URL+"/export/embed.html?"+$.param(r))+'" style="border: 1px solid black"></iframe><br/><small><a href="'+d(t.getUrl(n))+'">'+d(I18n.t("javascripts.share.view_larger_map"))+"</a></small>"),$("#geo_uri").attr("href",t.getGeoUri(n)).html(t.getGeoUri(n)),o.isEnabled()&&(e=o.getBounds());var a=$("#mapnik_scale").val(),s=L.bounds(L.CRS.EPSG3857.project(e.getSouthWest()),L.CRS.EPSG3857.project(e.getNorthEast())).getSize(),c=Math.floor(Math.sqrt(s.x*s.y/.3136));$("#mapnik_minlon").val(e.getWest()),$("#mapnik_minlat").val(e.getSouth()),$("#mapnik_maxlon").val(e.getEast()),$("#mapnik_maxlat").val(e.getNorth()),a<c&&(a=y(c),$("#mapnik_scale").val(a)),$("#mapnik_image_width").text(Math.round(s.x/a/28e-5)),$("#mapnik_image_height").text(Math.round(s.y/a/28e-5)),"mapnik"===t.getMapBaseLayerId()?($("#export-image").show(),$("#export-warning").hide()):($("#export-image").hide(),$("#export-warning").show())}function h(){$(this).select()}function m(){var e=t.getBounds(),n=e.getCenter().lat,o=6378137*Math.PI*Math.cos(n*Math.PI/180)*(e.getEast()-e.getWest())/180,r=t.getSize().x/o,i=1/3622.0492;return Math.round(1/(r*i))}function y(t){var e=5*Math.pow(10,Math.floor(Math.LOG10E*Math.log(t))-2);return e*Math.ceil(t/e)}var g=$("<div>").attr("class","section share-link").appendTo(r);$("<h4>").text(I18n.t("javascripts.share.link")).appendTo(g);var v=$("<form>").appendTo(g);$("<div>").attr("class","form-check mb-3").appendTo(v).append($("<label>").attr("for","link_marker").attr("class","form-check-label").append($("<input>").attr("id","link_marker").attr("type","checkbox").attr("class","form-check-input").bind("change",s)).append(I18n.t("javascripts.share.include_marker"))),$("<div class='btn-group btn-group-sm mb-2'>").appendTo(v).append($("<a class='btn btn-primary'>").addClass("active").attr("for","long_input").attr("id","long_link").text(I18n.t("javascripts.share.long_link"))).append($("<a class='btn btn-primary'>").attr("for","short_input").attr("id","short_link").text(I18n.t("javascripts.share.short_link"))).append($("<a class='btn btn-primary'>").attr("for","embed_html").attr("href","#").text(I18n.t("javascripts.share.embed"))).on("click","a",(function(t){t.preventDefault();var e="#"+$(this).attr("for");$(this).siblings("a").removeClass("active"),$(this).addClass("active"),g.find(".share-tab").hide(),g.find(".share-tab:has("+e+")").show().find("input, textarea").select()})),$("<div>").attr("class","share-tab").css("display","block").appendTo(v).append($("<input>").attr("id","long_input").attr("type","text").on("click",h)),$("<div>").attr("class","share-tab").appendTo(v).append($("<input>").attr("id","short_input").attr("type","text").on("click",h)),$("<div>").attr("class","share-tab").appendTo(v).append($("<textarea>").attr("id","embed_html").on("click",h)).append($("<p>").attr("class","text-muted").text(I18n.t("javascripts.share.paste_html")));var _=$("<div>").attr("class","section share-geo-uri").appendTo(r);$("<h4>").text(I18n.t("javascripts.share.geo_uri")).appendTo(_),$("<div>").appendTo(_).append($("<a>").attr("id","geo_uri"));var b=$("<div>").attr("class","section share-image").appendTo(r);$("<h4>").text(I18n.t("javascripts.share.image")).appendTo(b),$("<div>").attr("id","export-warning").attr("class","text-muted").text(I18n.t("javascripts.share.only_standard_layer")).appendTo(b),v=$("<form>").attr("id","export-image").attr("action","/export/finish").attr("method","post").appendTo(b),$("<div>").attr("class","mb-3 form-check").appendTo(v).append($("<label>").attr("for","image_filter").attr("class","form-check-label").append($("<input>").attr("id","image_filter").attr("type","checkbox").attr("class","form-check-input").bind("change",c)).append(I18n.t("javascripts.share.custom_dimensions"))),$("<div>").appendTo(v).append($("<label>").attr("for","mapnik_format").text(I18n.t("javascripts.share.format"))).append($("<select>").attr("name","mapnik_format").attr("id","mapnik_format").append($("<option>").val("png").text("PNG").prop("selected",!0)).append($("<option>").val("jpeg").text("JPEG")).append($("<option>").val("svg").text("SVG")).append($("<option>").val("pdf").text("PDF"))),$("<div>").appendTo(v).append($("<label>").attr("for","mapnik_scale").text(I18n.t("javascripts.share.scale"))).append("1 : ").append($("<input>").attr("name","mapnik_scale").attr("id","mapnik_scale").attr("type","text").on("change",f)),["minlon","minlat","maxlon","maxlat"].forEach((function(t){$("<input>").attr("id","mapnik_"+t).attr("name",t).attr("type","hidden").appendTo(v)})),$("<input>").attr("name","format").attr("value","mapnik").attr("type","hidden").appendTo(v);var S=$("meta[name=csrf-param]").attr("content"),x=$("meta[name=csrf-token]").attr("content");$("<input>").attr("name",S).attr("value",x).attr("type","hidden").appendTo(v);var w={width:'<span id="mapnik_image_width"></span>',height:'<span id="mapnik_image_height"></span>'};$("<p>").attr("class","text-muted").html(I18n.t("javascripts.share.image_dimensions",w)).appendTo(v),$("<input>").attr("type","submit").attr("class","btn btn-primary").attr("value",I18n.t("javascripts.share.download")).appendTo(v),o.on("change",f).addTo(t),n.on("dragend",u),t.on("move",l),t.on("moveend layeradd layerremove",f),r.on("show",i).on("hide",a)},e},function(){"use strict";var t=function(t){return(t="number"==typeof t?{precision:t}:t||{}).precision=t.precision||5,t.factor=t.factor||Math.pow(10,t.precision),t.dimension=t.dimension||2,t},e={encode:function(e,n){n=t(n);for(var o=[],r=0,i=e.length;r<i;++r){var a=e[r];if(2===n.dimension)o.push(a.lat||a[0]),o.push(a.lng||a[1]);else for(var s=0;s<n.dimension;++s)o.push(a[s])}return this.encodeDeltas(o,n)},decode:function(e,n){n=t(n);for(var o=this.decodeDeltas(e,n),r=[],i=0,a=o.length;i+(n.dimension-1)<a;){for(var s=[],c=0;c<n.dimension;++c)s.push(o[i++]);r.push(s)}return r},encodeDeltas:function(e,n){n=t(n);for(var o=[],r=0,i=e.length;r<i;)for(var a=0;a<n.dimension;++a,++r){var s=e[r].toFixed(n.precision),c=s-(o[a]||0);o[a]=s,e[r]=c}return this.encodeFloats(e,n)},decodeDeltas:function(e,n){n=t(n);for(var o=[],r=this.decodeFloats(e,n),i=0,a=r.length;i<a;)for(var s=0;s<n.dimension;++s,++i)r[i]=Math.round((o[s]=r[i]+(o[s]||0))*n.factor)/n.factor;return r},encodeFloats:function(e,n){n=t(n);for(var o=0,r=e.length;o<r;++o)e[o]=Math.round(e[o]*n.factor);return this.encodeSignedIntegers(e)},decodeFloats:function(e,n){n=t(n);for(var o=this.decodeSignedIntegers(e),r=0,i=o.length;r<i;++r)o[r]/=n.factor;return o},encodeSignedIntegers:function(t){for(var e=0,n=t.length;e<n;++e){var o=t[e];t[e]=o<0?~(o<<1):o<<1}return this.encodeUnsignedIntegers(t)},decodeSignedIntegers:function(t){for(var e=this.decodeUnsignedIntegers(t),n=0,o=e.length;n<o;++n){var r=e[n];e[n]=1&r?~(r>>1):r>>1}return e},encodeUnsignedIntegers:function(t){for(var e="",n=0,o=t.length;n<o;++n)e+=this.encodeUnsignedInteger(t[n]);return e},decodeUnsignedIntegers:function(t){for(var e=[],n=0,o=0,r=0,i=t.length;r<i;++r){var a=t.charCodeAt(r)-63;n|=(31&a)<<o,a<32?(e.push(n),n=0,o=0):o+=5}return e},encodeSignedInteger:function(t){return t=t<0?~(t<<1):t<<1,this.encodeUnsignedInteger(t)},encodeUnsignedInteger:function(t){for(var e,n="";t>=32;)e=63+(32|31&t),n+=String.fromCharCode(e),t>>=5;return e=t+63,n+=String.fromCharCode(e)}};if("object"==typeof module&&"object"==typeof module.exports&&(module.exports=e),"object"==typeof L){L.Polyline.prototype.fromEncoded||(L.Polyline.fromEncoded=function(t,n){return L.polyline(e.decode(t),n)}),L.Polygon.prototype.fromEncoded||(L.Polygon.fromEncoded=function(t,n){return L.polygon(e.decode(t),n)});var n={encodePath:function(){return e.encode(this.getLatLngs())}};L.Polyline.prototype.encodePath||L.Polyline.include(n),L.Polygon.prototype.encodePath||L.Polygon.include(n),L.PolylineUtil=e}}(),L.OSM.query=function(t){var e=L.control(t);return e.onAdd=function(t){function e(){var e=o.hasClass("disabled"),n=t.getZoom()<14;o.toggleClass("disabled",n).attr("data-bs-original-title",I18n.t(n?"javascripts.site.queryfeature_disabled_tooltip":"javascripts.site.queryfeature_tooltip")),n&&!e?o.trigger("disabled"):e&&!n&&o.trigger("enabled")}var n=$("<div>").attr("class","control-query"),o=$("<a>").attr("class","control-button").attr("href","#").html('<span class="icon query"></span>').appendTo(n);return t.on("zoomend",e),e(),n[0]},e},function(t){var e;if("function"==typeof define&&define.amd)define(["leaflet"],t);else if("object"==typeof module&&"object"==typeof module.exports)e=require("leaflet"),module.exports=t(e);else{if(void 0===window.L)throw new Error("Leaflet must be loaded first");t(window.L)}}((function(t){t.Map.mergeOptions({contextmenuItems:[]}),t.Map.ContextMenu=t.Handler.extend({_touchstart:t.Browser.msPointer?"MSPointerDown":t.Browser.pointer?"pointerdown":"touchstart",statics:{BASE_CLS:"leaflet-contextmenu"},initialize:function(e){t.Handler.prototype.initialize.call(this,e),this._items=[],this._visible=!1;var n=this._container=t.DomUtil.create("div",t.Map.ContextMenu.BASE_CLS,e._container);n.style.zIndex=1e4,n.style.position="absolute",e.options.contextmenuWidth&&(n.style.width=e.options.contextmenuWidth+"px"),this._createItems(),t.DomEvent.on(n,"click",t.DomEvent.stop).on(n,"mousedown",t.DomEvent.stop).on(n,"dblclick",t.DomEvent.stop).on(n,"contextmenu",t.DomEvent.stop)},addHooks:function(){var e=this._map.getContainer();t.DomEvent.on(e,"mouseleave",this._hide,this).on(document,"keydown",this._onKeyDown,this),t.Browser.touch&&t.DomEvent.on(document,this._touchstart,this._hide,this),this._map.on({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},removeHooks:function(){var e=this._map.getContainer();t.DomEvent.off(e,"mouseleave",this._hide,this).off(document,"keydown",this._onKeyDown,this),t.Browser.touch&&t.DomEvent.off(document,this._touchstart,this._hide,this),this._map.off({contextmenu:this._show,mousedown:this._hide,zoomstart:this._hide},this)},showAt:function(e,n){e instanceof t.LatLng&&(e=this._map.latLngToContainerPoint(e)),this._showAtPoint(e,n)},hide:function(){this._hide()},addItem:function(t){return this.insertItem(t)},insertItem:function(t,e){e=void 0!==e?e:this._items.length;var n=this._createItem(this._container,t,e);return this._items.push(n),this._sizeChanged=!0,this._map.fire("contextmenu.additem",{contextmenu:this,el:n.el,index:e}),n.el},removeItem:function(e){var n=this._container;return isNaN(e)||(e=n.children[e]),e?(this._removeItem(t.Util.stamp(e)),this._sizeChanged=!0,this._map.fire("contextmenu.removeitem",{contextmenu:this,el:e}),e):null},removeAllItems:function(){for(var e,n=this._container.children;n.length;)e=n[0],this._removeItem(t.Util.stamp(e));return n},hideAllItems:function(){var t,e;for(t=0,e=this._items.length;t<e;t++)this._items[t].el.style.display="none"},showAllItems:function(){var t,e;for(t=0,e=this._items.length;t<e;t++)this._items[t].el.style.display=""},setDisabled:function(e,n){var o=this._container,r=t.Map.ContextMenu.BASE_CLS+"-item";isNaN(e)||(e=o.children[e]),e&&t.DomUtil.hasClass(e,r)&&(n?(t.DomUtil.addClass(e,r+"-disabled"),this._map.fire("contextmenu.disableitem",{contextmenu:this,el:e})):(t.DomUtil.removeClass(e,r+"-disabled"),this._map.fire("contextmenu.enableitem",{contextmenu:this,el:e})))},isVisible:function(){return this._visible},_createItems:function(){var t,e,n=this._map.options.contextmenuItems;for(t=0,e=n.length;t<e;t++)this._items.push(this._createItem(this._container,n[t]))},_createItem:function(e,n,o){if(n.separator||"-"===n)return this._createSeparator(e,o);var r=t.Map.ContextMenu.BASE_CLS+"-item",i=n.disabled?r+" "+r+"-disabled":r,a=this._insertElementAt("a",i,e,o),s=this._createEventHandler(a,n.callback,n.context,n.hideOnSelect),c=this._getIcon(n),l=this._getIconCls(n),u="";return c?u='<img class="'+t.Map.ContextMenu.BASE_CLS+'-icon" src="'+c+'"/>':l&&(u='<span class="'+t.Map.ContextMenu.BASE_CLS+"-icon "+l+'"></span>'),a.innerHTML=u+n.text,a.href="#",t.DomEvent.on(a,"mouseover",this._onItemMouseOver,this).on(a,"mouseout",this._onItemMouseOut,this).on(a,"mousedown",t.DomEvent.stopPropagation).on(a,"click",s),t.Browser.touch&&t.DomEvent.on(a,this._touchstart,t.DomEvent.stopPropagation),t.Browser.pointer||t.DomEvent.on(a,"click",this._onItemMouseOut,this),{id:t.Util.stamp(a),el:a,callback:s}},_removeItem:function(e){var n,o,r,i,a;for(r=0,i=this._items.length;r<i;r++)if((n=this._items[r]).id===e)return o=n.el,(a=n.callback)&&(t.DomEvent.off(o,"mouseover",this._onItemMouseOver,this).off(o,"mouseover",this._onItemMouseOut,this).off(o,"mousedown",t.DomEvent.stopPropagation).off(o,"click",a),t.Browser.touch&&t.DomEvent.off(o,this._touchstart,t.DomEvent.stopPropagation),t.Browser.pointer||t.DomEvent.on(o,"click",this._onItemMouseOut,this)),this._container.removeChild(o),this._items.splice(r,1),n;return null},_createSeparator:function(e,n){var o=this._insertElementAt("div",t.Map.ContextMenu.BASE_CLS+"-separator",e,n);return{id:t.Util.stamp(o),el:o}},_createEventHandler:function(e,n,o,r){var i=this,a=(this._map,t.Map.ContextMenu.BASE_CLS+"-item-disabled");r=void 0===r||r;return function(){if(!t.DomUtil.hasClass(e,a)){var s=i._map,c=i._showLocation.containerPoint,l=s.containerPointToLayerPoint(c),u={containerPoint:c,layerPoint:l,latlng:s.layerPointToLatLng(l),relatedTarget:i._showLocation.relatedTarget};r&&i._hide(),n&&n.call(o||s,u),i._map.fire("contextmenu.select",{contextmenu:i,el:e})}}},_insertElementAt:function(t,e,n,o){var r,i=document.createElement(t);return i.className=e,void 0!==o&&(r=n.children[o]),r?n.insertBefore(i,r):n.appendChild(i),i},_show:function(t){this._showAtPoint(t.containerPoint,t)},_showAtPoint:function(e,n){if(this._items.length){this._map;var o=t.extend(n||{},{contextmenu:this});this._showLocation={containerPoint:e},n&&n.relatedTarget&&(this._showLocation.relatedTarget=n.relatedTarget),this._setPosition(e),this._visible||(this._container.style.display="block",this._visible=!0),this._map.fire("contextmenu.show",o)}},_hide:function(){this._visible&&(this._visible=!1,this._container.style.display="none",this._map.fire("contextmenu.hide",{contextmenu:this}))},_getIcon:function(e){
return t.Browser.retina&&e.retinaIcon||e.icon},_getIconCls:function(e){return t.Browser.retina&&e.retinaIconCls||e.iconCls},_setPosition:function(e){var n,o=this._map.getSize(),r=this._container,i=this._getElementSize(r);this._map.options.contextmenuAnchor&&(n=t.point(this._map.options.contextmenuAnchor),e=e.add(n)),r._leaflet_pos=e,e.x+i.x>o.x?(r.style.left="auto",r.style.right=Math.min(Math.max(o.x-e.x,0),o.x-i.x-1)+"px"):(r.style.left=Math.max(e.x,0)+"px",r.style.right="auto"),e.y+i.y>o.y?(r.style.top="auto",r.style.bottom=Math.min(Math.max(o.y-e.y,0),o.y-i.y-1)+"px"):(r.style.top=Math.max(e.y,0)+"px",r.style.bottom="auto")},_getElementSize:function(t){var e=this._size,n=t.style.display;return e&&!this._sizeChanged||(e={},t.style.left="-999999px",t.style.right="auto",t.style.display="block",e.x=t.offsetWidth,e.y=t.offsetHeight,t.style.left="auto",t.style.display=n,this._sizeChanged=!1),e},_onKeyDown:function(t){27===t.keyCode&&this._hide()},_onItemMouseOver:function(e){t.DomUtil.addClass(e.target||e.srcElement,"over")},_onItemMouseOut:function(e){t.DomUtil.removeClass(e.target||e.srcElement,"over")}}),t.Map.addInitHook("addHandler","contextmenu",t.Map.ContextMenu),t.Mixin.ContextMenu={bindContextMenu:function(e){return t.setOptions(this,e),this._initContextMenu(),this},unbindContextMenu:function(){return this.off("contextmenu",this._showContextMenu,this),this},addContextMenuItem:function(t){this.options.contextmenuItems.push(t)},removeContextMenuItemWithIndex:function(t){for(var e=[],n=0;n<this.options.contextmenuItems.length;n++)this.options.contextmenuItems[n].index==t&&e.push(n);for(var o=e.pop();void 0!==o;)this.options.contextmenuItems.splice(o,1),o=e.pop()},replaceContextMenuItem:function(t){this.removeContextMenuItemWithIndex(t.index),this.addContextMenuItem(t)},_initContextMenu:function(){this._items=[],this.on("contextmenu",this._showContextMenu,this)},_showContextMenu:function(e){var n,o,r,i,a;if(this._map.contextmenu){for(o=t.extend({relatedTarget:this},e),r=this._map.mouseEventToContainerPoint(e.originalEvent),this.options.contextmenuInheritItems||this._map.contextmenu.hideAllItems(),i=0,a=this.options.contextmenuItems.length;i<a;i++)n=this.options.contextmenuItems[i],this._items.push(this._map.contextmenu.insertItem(n,n.index));this._map.once("contextmenu.hide",this._hideContextMenu,this),this._map.contextmenu.showAt(r,o)}},_hideContextMenu:function(){var t,e;for(t=0,e=this._items.length;t<e;t++)this._map.contextmenu.removeItem(this._items[t]);this._items.length=0,this.options.contextmenuInheritItems||this._map.contextmenu.showAllItems()}};var e,n,o,r=[t.Marker,t.Path],i={contextmenu:!1,contextmenuItems:[],contextmenuInheritItems:!0};for(n=0,o=r.length;n<o;n++)(e=r[n]).prototype.options?e.mergeOptions(i):e.prototype.options=i,e.addInitHook((function(){this.options.contextmenu&&this._initContextMenu()})),e.include(t.Mixin.ContextMenu);return t.Map.ContextMenu})),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Qs=t()}}((function(){return function(){function t(e,n,o){function r(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};e[a][0].call(u.exports,(function(t){return r(e[a][1][t]||t)}),u,u.exports,t,e,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}return t}()({1:[function(t,e){"use strict";var n=String.prototype.replace,o=/%20/g,r={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports={default:r.RFC3986,formatters:{RFC1738:function(t){return n.call(t,o,"+")},RFC3986:function(t){return String(t)}},RFC1738:r.RFC1738,RFC3986:r.RFC3986}},{}],2:[function(t,e){"use strict";var n=t("./stringify"),o=t("./parse"),r=t("./formats");e.exports={formats:r,parse:o,stringify:n}},{"./formats":1,"./parse":3,"./stringify":4}],3:[function(t,e){"use strict";var n=t("./utils"),o=Object.prototype.hasOwnProperty,r=Array.isArray,i={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},s=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},c="utf8=%26%2310003%3B",l="utf8=%E2%9C%93",u=function(t,e){var u,p={__proto__:null},d=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,f=e.parameterLimit===1/0?void 0:e.parameterLimit,h=d.split(e.delimiter,f),m=-1,y=e.charset;if(e.charsetSentinel)for(u=0;u<h.length;++u)0===h[u].indexOf("utf8=")&&(h[u]===l?y="utf-8":h[u]===c&&(y="iso-8859-1"),m=u,u=h.length);for(u=0;u<h.length;++u)if(u!==m){var g,v,_=h[u],b=_.indexOf("]="),S=-1===b?_.indexOf("="):b+1;-1===S?(g=e.decoder(_,i.decoder,y,"key"),v=e.strictNullHandling?null:""):(g=e.decoder(_.slice(0,S),i.decoder,y,"key"),v=n.maybeMap(s(_.slice(S+1),e),(function(t){return e.decoder(t,i.decoder,y,"value")}))),v&&e.interpretNumericEntities&&"iso-8859-1"===y&&(v=a(v)),_.indexOf("[]=")>-1&&(v=r(v)?[v]:v),o.call(p,g)?p[g]=n.combine(p[g],v):p[g]=v}return p},p=function(t,e,n,o){for(var r=o?e:s(e,n),i=t.length-1;i>=0;--i){var a,c=t[i];if("[]"===c&&n.parseArrays)a=[].concat(r);else{a=n.plainObjects?Object.create(null):{};var l="["===c.charAt(0)&&"]"===c.charAt(c.length-1)?c.slice(1,-1):c,u=parseInt(l,10);n.parseArrays||""!==l?!isNaN(u)&&c!==l&&String(u)===l&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(a=[])[u]=r:"__proto__"!==l&&(a[l]=r):a={0:r}}r=a}return r},d=function(t,e,n,r){if(t){var i=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,a=/(\[[^[\]]*])/,s=/(\[[^[\]]*])/g,c=n.depth>0&&a.exec(i),l=c?i.slice(0,c.index):i,u=[];if(l){if(!n.plainObjects&&o.call(Object.prototype,l)&&!n.allowPrototypes)return;u.push(l)}for(var d=0;n.depth>0&&null!==(c=s.exec(i))&&d<n.depth;){if(d+=1,!n.plainObjects&&o.call(Object.prototype,c[1].slice(1,-1))&&!n.allowPrototypes)return;u.push(c[1])}return c&&u.push("["+i.slice(c.index)+"]"),p(u,e,n,r)}},f=function(t){if(!t)return i;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?i.charset:t.charset;return{allowDots:void 0===t.allowDots?i.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:i.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:i.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:i.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:i.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:i.comma,decoder:"function"==typeof t.decoder?t.decoder:i.decoder,delimiter:"string"==typeof t.delimiter||n.isRegExp(t.delimiter)?t.delimiter:i.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:i.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:i.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:i.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:i.strictNullHandling}};e.exports=function(t,e){var o=f(e);if(""===t||null==t)return o.plainObjects?Object.create(null):{};for(var r="string"==typeof t?u(t,o):t,i=o.plainObjects?Object.create(null):{},a=Object.keys(r),s=0;s<a.length;++s){var c=a[s],l=d(c,r[c],o,"string"==typeof t);i=n.merge(i,l,o)}return!0===o.allowSparse?i:n.compact(i)}},{"./utils":5}],4:[function(t,e){"use strict";var n=t("side-channel"),o=t("./utils"),r=t("./formats"),i=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},s=Array.isArray,c=Array.prototype.push,l=function(t,e){c.apply(t,s(e)?e:[e])},u=Date.prototype.toISOString,p=r.default,d={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:o.encode,encodeValuesOnly:!1,format:p,formatter:r.formatters[p],indices:!1,serializeDate:function(t){return u.call(t)},skipNulls:!1,strictNullHandling:!1},f=function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t},h={},m=function t(e,r,i,a,c,u,p,m,y,g,v,_,b,S,x,w){for(var O=e,M=w,$=0,L=!1;void 0!==(M=M.get(h))&&!L;){var k=M.get(e);if($+=1,void 0!==k){if(k===$)throw new RangeError("Cyclic object value");L=!0}void 0===M.get(h)&&($=0)}if("function"==typeof m?O=m(r,O):O instanceof Date?O=v(O):"comma"===i&&s(O)&&(O=o.maybeMap(O,(function(t){return t instanceof Date?v(t):t}))),null===O){if(c)return p&&!S?p(r,d.encoder,x,"key",_):r;O=""}if(f(O)||o.isBuffer(O))return p?[b(S?r:p(r,d.encoder,x,"key",_))+"="+b(p(O,d.encoder,x,"value",_))]:[b(r)+"="+b(String(O))];var E,C=[];if(void 0===O)return C;if("comma"===i&&s(O))S&&p&&(O=o.maybeMap(O,p)),E=[{value:O.length>0?O.join(",")||null:void 0}];else if(s(m))E=m;else{var j=Object.keys(O);E=y?j.sort(y):j}for(var I=a&&s(O)&&1===O.length?r+"[]":r,P=0;P<E.length;++P){var A=E[P],T="object"==typeof A&&void 0!==A.value?A.value:O[A];if(!u||null!==T){var D=s(O)?"function"==typeof i?i(I,A):I:I+(g?"."+A:"["+A+"]");w.set(e,$);var F=n();F.set(h,w),l(C,t(T,D,i,a,c,u,"comma"===i&&S&&s(O)?null:p,m,y,g,v,_,b,S,x,F))}}return C},y=function(t){if(!t)return d;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||d.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=r.default;if(void 0!==t.format){if(!i.call(r.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var o=r.formatters[n],a=d.filter;return("function"==typeof t.filter||s(t.filter))&&(a=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:d.addQueryPrefix,allowDots:void 0===t.allowDots?d.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:d.charsetSentinel,delimiter:void 0===t.delimiter?d.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:d.encode,encoder:"function"==typeof t.encoder?t.encoder:d.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:d.encodeValuesOnly,filter:a,format:n,formatter:o,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:d.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:d.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:d.strictNullHandling}};e.exports=function(t,e){var o,r=t,i=y(e);"function"==typeof i.filter?r=(0,i.filter)("",r):s(i.filter)&&(o=i.filter);var c,u=[];if("object"!=typeof r||null===r)return"";c=e&&e.arrayFormat in a?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var p=a[c];if(e&&"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var d="comma"===p&&e&&e.commaRoundTrip;o||(o=Object.keys(r)),i.sort&&o.sort(i.sort);for(var f=n(),h=0;h<o.length;++h){var g=o[h];i.skipNulls&&null===r[g]||l(u,m(r[g],g,p,d,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,f))}var v=u.join(i.delimiter),_=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?_+="utf8=%26%2310003%3B&":_+="utf8=%E2%9C%93&"),v.length>0?_+v:""}},{"./formats":1,"./utils":5,"side-channel":17}],5:[function(t,e){"use strict";var n=t("./formats"),o=Object.prototype.hasOwnProperty,r=Array.isArray,i=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(r(n)){for(var o=[],i=0;i<n.length;++i)void 0!==n[i]&&o.push(n[i]);e.obj[e.prop]=o}}},s=function(t,e){for(var n=e&&e.plainObjects?Object.create(null):{},o=0;o<t.length;++o)void 0!==t[o]&&(n[o]=t[o]);return n},c=function t(e,n,i){if(!n)return e;if("object"!=typeof n){if(r(e))e.push(n);else{if(!e||"object"!=typeof e)return[e,n];(i&&(i.plainObjects||i.allowPrototypes)||!o.call(Object.prototype,n))&&(e[n]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(n);var a=e;return r(e)&&!r(n)&&(a=s(e,i)),r(e)&&r(n)?(n.forEach((function(n,r){if(o.call(e,r)){var a=e[r];a&&"object"==typeof a&&n&&"object"==typeof n?e[r]=t(a,n,i):e.push(n)}else e[r]=n})),e):Object.keys(n).reduce((function(e,r){var a=n[r];return o.call(e,r)?e[r]=t(e[r],a,i):e[r]=a,e}),a)},l=function(t,e){return Object.keys(e).reduce((function(t,n){return t[n]=e[n],t}),t)},u=function(t,e,n){var o=t.replace(/\+/g," ");if("iso-8859-1"===n)return o.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(o)}catch(t){return o}},p=function(t,e,o,r,a){if(0===t.length)return t;var s=t;if("symbol"==typeof t?s=Symbol.prototype.toString.call(t):"string"!=typeof t&&(s=String(t)),"iso-8859-1"===o)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var c="",l=0;l<s.length;++l){var u=s.charCodeAt(l);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||a===n.RFC1738&&(40===u||41===u)?c+=s.charAt(l):u<128?c+=i[u]:u<2048?c+=i[192|u>>6]+i[128|63&u]:u<55296||u>=57344?c+=i[224|u>>12]+i[128|u>>6&63]+i[128|63&u]:(l+=1,u=65536+((1023&u)<<10|1023&s.charCodeAt(l)),c+=i[240|u>>18]+i[128|u>>12&63]+i[128|u>>6&63]+i[128|63&u])}return c},d=function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],o=0;o<e.length;++o)for(var r=e[o],i=r.obj[r.prop],s=Object.keys(i),c=0;c<s.length;++c){var l=s[c],u=i[l];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(e.push({obj:i,prop:l}),n.push(u))}return a(e),t},f=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},h=function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},m=function(t,e){return[].concat(t,e)},y=function(t,e){if(r(t)){for(var n=[],o=0;o<t.length;o+=1)n.push(e(t[o]));return n}return e(t)};e.exports={arrayToObject:s,assign:l,combine:m,compact:d,decode:u,encode:p,isBuffer:h,isRegExp:f,maybeMap:y,merge:c}},{"./formats":1}],6:[function(){},{}],7:[function(t,e){"use strict";var n=t("get-intrinsic"),o=t("./"),r=o(n("String.prototype.indexOf"));e.exports=function(t,e){var i=n(t,!!e);return"function"==typeof i&&r(t,".prototype.")>-1?o(i):i}},{"./":8,"get-intrinsic":11}],8:[function(t,e){"use strict";var n=t("function-bind"),o=t("get-intrinsic"),r=o("%Function.prototype.apply%"),i=o("%Function.prototype.call%"),a=o("%Reflect.apply%",!0)||n.call(i,r),s=o("%Object.getOwnPropertyDescriptor%",!0),c=o("%Object.defineProperty%",!0),l=o("%Math.max%");if(c)try{c({},"a",{value:1})}catch(t){c=null}e.exports=function(t){var e=a(n,i,arguments);s&&c&&(s(e,"length").configurable&&c(e,"length",{value:1+l(0,t.length-(arguments.length-1))}));return e};var u=function(){return a(n,r,arguments)};c?c(e.exports,"apply",{value:u}):e.exports.apply=u},{"function-bind":10,"get-intrinsic":11}],9:[function(t,e){"use strict";var n="Function.prototype.bind called on incompatible ",o=Array.prototype.slice,r=Object.prototype.toString,i="[object Function]";e.exports=function(t){var e=this;if("function"!=typeof e||r.call(e)!==i)throw new TypeError(n+e);for(var a,s=o.call(arguments,1),c=function(){if(this instanceof a){var n=e.apply(this,s.concat(o.call(arguments)));return Object(n)===n?n:this}return e.apply(t,s.concat(o.call(arguments)))},l=Math.max(0,e.length-s.length),u=[],p=0;p<l;p++)u.push("$"+p);if(a=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(c),e.prototype){var d=function(){};d.prototype=e.prototype,a.prototype=new d,d.prototype=null}return a}},{}],10:[function(t,e){"use strict";var n=t("./implementation");e.exports=Function.prototype.bind||n},{"./implementation":9}],11:[function(t,e){"use strict";var n,o=SyntaxError,r=Function,i=TypeError,a=function(t){try{return r('"use strict"; return ('+t+").constructor;")()}catch(t){}},s=Object.getOwnPropertyDescriptor;if(s)try{s({},"")}catch(t){s=null}var c=function(){throw new i},l=s?function(){try{return arguments.callee,c}catch(t){try{return s(arguments,"callee").get}catch(t){return c}}}():c,u=t("has-symbols")(),p=t("has-proto")(),d=Object.getPrototypeOf||(p?function(t){return t.__proto__}:null),f={},h="undefined"!=typeof Uint8Array&&d?d(Uint8Array):n,m={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":u&&d?d([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":r,"%GeneratorFunction%":f,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u&&d?d(d([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&u&&d?d((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&u&&d?d((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u&&d?d(""[Symbol.iterator]()):n,"%Symbol%":u?Symbol:n,"%SyntaxError%":o,"%ThrowTypeError%":l,"%TypedArray%":h,"%TypeError%":i,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(d)try{null.error}catch(t){var y=d(d(t));m["%Error.prototype%"]=y}var g=function t(e){var n;if("%AsyncFunction%"===e)n=a("async function () {}");else if("%GeneratorFunction%"===e)n=a("function* () {}");else if("%AsyncGeneratorFunction%"===e)n=a("async function* () {}");else if("%AsyncGenerator%"===e){var o=t("%AsyncGeneratorFunction%");o&&(n=o.prototype)}else if("%AsyncIteratorPrototype%"===e){var r=t("%AsyncGenerator%");r&&d&&(n=d(r.prototype))}return m[e]=n,n},v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},_=t("function-bind"),b=t("has"),S=_.call(Function.call,Array.prototype.concat),x=_.call(Function.apply,Array.prototype.splice),w=_.call(Function.call,String.prototype.replace),O=_.call(Function.call,String.prototype.slice),M=_.call(Function.call,RegExp.prototype.exec),$=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,L=/\\(\\)?/g,k=function(t){var e=O(t,0,1),n=O(t,-1);if("%"===e&&"%"!==n)throw new o("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==e)throw new o("invalid intrinsic syntax, expected opening `%`");var r=[];return w(t,$,(function(t,e,n,o){r[r.length]=n?w(o,L,"$1"):e||t})),r},E=function(t,e){var n,r=t;if(b(v,r)&&(r="%"+(n=v[r])[0]+"%"),b(m,r)){var a=m[r];if(a===f&&(a=g(r)),void 0===a&&!e)throw new i("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:a}}throw new o("intrinsic "+t+" does not exist!")};e.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new i("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new i('"allowMissing" argument must be a boolean');if(null===M(/^%?[^%]*%?$/,t))throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=k(t),r=n.length>0?n[0]:"",a=E("%"+r+"%",e),c=a.name,l=a.value,u=!1,p=a.alias;p&&(r=p[0],x(n,S([0,1],p)));for(var d=1,f=!0;d<n.length;d+=1){var h=n[d],y=O(h,0,1),g=O(h,-1);if(('"'===y||"'"===y||"`"===y||'"'===g||"'"===g||"`"===g)&&y!==g)throw new o("property names with quotes must have matching quotes");if("constructor"!==h&&f||(u=!0),b(m,c="%"+(r+="."+h)+"%"))l=m[c];else if(null!=l){if(!(h in l)){if(!e)throw new i("base intrinsic for "+t+" exists, but the property is not available.");return}if(s&&d+1>=n.length){var v=s(l,h);l=(f=!!v)&&"get"in v&&!("originalValue"in v.get)?v.get:l[h]}else f=b(l,h),l=l[h];f&&!u&&(m[c]=l)}}return l}},{"function-bind":10,has:15,"has-proto":12,"has-symbols":13}],12:[function(t,e){"use strict";var n={foo:{}},o=Object;e.exports=function(){return{__proto__:n}.foo===n.foo&&!({__proto__:null}instanceof o)}},{}],13:[function(t,e){"use strict";var n="undefined"!=typeof Symbol&&Symbol,o=t("./shams");e.exports=function(){return"function"==typeof n&&("function"==typeof Symbol&&("symbol"==typeof n("foo")&&("symbol"==typeof Symbol("bar")&&o())))}},{"./shams":14}],14:[function(t,e){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),n=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;var o=42;for(e in t[e]=o,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var r=Object.getOwnPropertySymbols(t);if(1!==r.length||r[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(t,e);if(i.value!==o||!0!==i.enumerable)return!1}return!0}},{}],15:[function(t,e){"use strict";var n=t("function-bind");e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":10}],16:[function(t,e){function n(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||Y.call(/e/,e))return e;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var o=t<0?-nt(-t):nt(t);if(o!==t){var r=String(o),i=Z.call(e,r.length+1);return K.call(r,n,"$&_")+"."+K.call(K.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return K.call(e,n,"$&_")}function o(t,e,n){var o="double"===(n.quoteStyle||e)?'"':"'";return o+t+o}function r(t){return K.call(String(t),/"/g,"&quot;")}function i(t){return!("[object Array]"!==m(t)||st&&"object"==typeof t&&st in t)}function a(t){return!("[object Date]"!==m(t)||st&&"object"==typeof t&&st in t)}function s(t){return!("[object RegExp]"!==m(t)||st&&"object"==typeof t&&st in t)}function c(t){return!("[object Error]"!==m(t)||st&&"object"==typeof t&&st in t)}function l(t){return!("[object String]"!==m(t)||st&&"object"==typeof t&&st in t)}function u(t){return!("[object Number]"!==m(t)||st&&"object"==typeof t&&st in t)}function p(t){return!("[object Boolean]"!==m(t)||st&&"object"==typeof t&&st in t)}function d(t){if(at)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!it)return!1;try{return it.call(t),!0}catch(t){}return!1}function f(t){if(!t||"object"!=typeof t||!ot)return!1;try{return ot.call(t),!0}catch(t){}return!1}function h(t,e){return ft.call(t,e)}function m(t){return V.call(t)}function y(t){if(t.name)return t.name;var e=W.call(G.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}function g(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0,o=t.length;n<o;n++)if(t[n]===e)return n;return-1}function v(t){if(!T||!t||"object"!=typeof t)return!1;try{T.call(t);try{R.call(t)}catch(t){return!0}return t instanceof Map}catch(t){}return!1}function _(t){if(!N||!t||"object"!=typeof t)return!1;try{N.call(t,N);try{z.call(t,z)}catch(t){return!0}return t instanceof WeakMap}catch(t){}return!1}function b(t){if(!q||!t||"object"!=typeof t)return!1;try{return q.call(t),!0}catch(t){}return!1}function S(t){if(!R||!t||"object"!=typeof t)return!1;try{R.call(t);try{T.call(t)}catch(t){return!0}return t instanceof Set}catch(t){}return!1}function x(t){if(!z||!t||"object"!=typeof t)return!1;try{z.call(t,z);try{N.call(t,N)}catch(t){return!0}return t instanceof WeakSet}catch(t){}return!1}function w(t){return!(!t||"object"!=typeof t)&&("undefined"!=typeof HTMLElement&&t instanceof HTMLElement||"string"==typeof t.nodeName&&"function"==typeof t.getAttribute)}function O(t,e){if(t.length>e.maxStringLength){var n=t.length-e.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return O(Z.call(t,0,e.maxStringLength),e)+r}return o(K.call(K.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,M),"single",e)}function M(t){var e=t.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return n?"\\"+n:"\\x"+(e<16?"0":"")+Q.call(e.toString(16))}function $(t){return"Object("+t+")"}function L(t){return t+" { ? }"}function k(t,e,n,o){return t+" ("+e+") {"+(o?j(n,o):tt.call(n,", "))+"}"}function E(t){for(var e=0;e<t.length;e++)if(g(t[e],"\n")>=0)return!1;return!0}function C(t,e){var n;if("\t"===t.indent)n="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;n=tt.call(Array(t.indent+1)," ")}return{base:n,prev:tt.call(Array(e+1),n)}}function j(t,e){if(0===t.length)return"";var n="\n"+e.prev+e.base;return n+tt.call(t,","+n)+"\n"+e.prev}function I(t,e){var n=i(t),o=[];if(n){o.length=t.length;for(var r=0;r<t.length;r++)o[r]=h(t,r)?e(t[r],t):""}var a,s="function"==typeof rt?rt(t):[];if(at){a={};for(var c=0;c<s.length;c++)a["$"+s[c]]=s[c]}for(var l in t)h(t,l)&&(n&&String(Number(l))===l&&l<t.length||at&&a["$"+l]instanceof Symbol||(Y.call(/[^\w$]/,l)?o.push(e(l,t)+": "+e(t[l],t)):o.push(l+": "+e(t[l],t))));if("function"==typeof rt)for(var u=0;u<s.length;u++)ct.call(t,s[u])&&o.push("["+e(s[u])+"]: "+e(t[s[u]],t));return o}var P="function"==typeof Map&&Map.prototype,A=Object.getOwnPropertyDescriptor&&P?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,T=P&&A&&"function"==typeof A.get?A.get:null,D=P&&Map.prototype.forEach,F="function"==typeof Set&&Set.prototype,B=Object.getOwnPropertyDescriptor&&F?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,R=F&&B&&"function"==typeof B.get?B.get:null,U=F&&Set.prototype.forEach,N="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,z="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,q="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,H=Boolean.prototype.valueOf,V=Object.prototype.toString,G=Function.prototype.toString,W=String.prototype.match,Z=String.prototype.slice,K=String.prototype.replace,Q=String.prototype.toUpperCase,J=String.prototype.toLowerCase,Y=RegExp.prototype.test,X=Array.prototype.concat,tt=Array.prototype.join,et=Array.prototype.slice,nt=Math.floor,ot="function"==typeof BigInt?BigInt.prototype.valueOf:null,rt=Object.getOwnPropertySymbols,it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,at="function"==typeof Symbol&&"object"==typeof Symbol.iterator,st="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===at||"symbol")?Symbol.toStringTag:null,ct=Object.prototype.propertyIsEnumerable,lt=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null),ut=t("./util.inspect"),pt=ut.custom,dt=d(pt)?pt:null;e.exports=function t(e,M,P,A){function F(e,n,o){if(n&&(A=et.call(A)).push(n),o){var r={depth:B.depth};return h(B,"quoteStyle")&&(r.quoteStyle=B.quoteStyle),t(e,r,P+1,A)}return t(e,B,P+1,A)}var B=M||{};if(h(B,"quoteStyle")&&"single"!==B.quoteStyle&&"double"!==B.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(h(B,"maxStringLength")&&("number"==typeof B.maxStringLength?B.maxStringLength<0&&B.maxStringLength!==1/0:null!==B.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var N=!h(B,"customInspect")||B.customInspect;if("boolean"!=typeof N&&"symbol"!==N)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(h(B,"indent")&&null!==B.indent&&"\t"!==B.indent&&!(parseInt(B.indent,10)===B.indent&&B.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`')
;if(h(B,"numericSeparator")&&"boolean"!=typeof B.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var z=B.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return O(e,B);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var q=String(e);return z?n(e,q):q}if("bigint"==typeof e){var V=String(e)+"n";return z?n(e,V):V}var G=void 0===B.depth?5:B.depth;if(void 0===P&&(P=0),P>=G&&G>0&&"object"==typeof e)return i(e)?"[Array]":"[Object]";var W=C(B,P);if(void 0===A)A=[];else if(g(A,e)>=0)return"[Circular]";if("function"==typeof e&&!s(e)){var Q=y(e),Y=I(e,F);return"[Function"+(Q?": "+Q:" (anonymous)")+"]"+(Y.length>0?" { "+tt.call(Y,", ")+" }":"")}if(d(e)){var nt=at?K.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):it.call(e);return"object"!=typeof e||at?nt:$(nt)}if(w(e)){for(var rt="<"+J.call(String(e.nodeName)),pt=e.attributes||[],ft=0;ft<pt.length;ft++)rt+=" "+pt[ft].name+"="+o(r(pt[ft].value),"double",B);return rt+=">",e.childNodes&&e.childNodes.length&&(rt+="..."),rt+="</"+J.call(String(e.nodeName))+">"}if(i(e)){if(0===e.length)return"[]";var ht=I(e,F);return W&&!E(ht)?"["+j(ht,W)+"]":"[ "+tt.call(ht,", ")+" ]"}if(c(e)){var mt=I(e,F);return"cause"in Error.prototype||!("cause"in e)||ct.call(e,"cause")?0===mt.length?"["+String(e)+"]":"{ ["+String(e)+"] "+tt.call(mt,", ")+" }":"{ ["+String(e)+"] "+tt.call(X.call("[cause]: "+F(e.cause),mt),", ")+" }"}if("object"==typeof e&&N){if(dt&&"function"==typeof e[dt]&&ut)return ut(e,{depth:G-P});if("symbol"!==N&&"function"==typeof e.inspect)return e.inspect()}if(v(e)){var yt=[];return D&&D.call(e,(function(t,n){yt.push(F(n,e,!0)+" => "+F(t,e))})),k("Map",T.call(e),yt,W)}if(S(e)){var gt=[];return U&&U.call(e,(function(t){gt.push(F(t,e))})),k("Set",R.call(e),gt,W)}if(_(e))return L("WeakMap");if(x(e))return L("WeakSet");if(b(e))return L("WeakRef");if(u(e))return $(F(Number(e)));if(f(e))return $(F(ot.call(e)));if(p(e))return $(H.call(e));if(l(e))return $(F(String(e)));if(!a(e)&&!s(e)){var vt=I(e,F),_t=lt?lt(e)===Object.prototype:e instanceof Object||e.constructor===Object,bt=e instanceof Object?"":"null prototype",St=!_t&&st&&Object(e)===e&&st in e?Z.call(m(e),8,-1):bt?"Object":"",xt=(_t||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(St||bt?"["+tt.call(X.call([],St||[],bt||[]),": ")+"] ":"");return 0===vt.length?xt+"{}":W?xt+"{"+j(vt,W)+"}":xt+"{ "+tt.call(vt,", ")+" }"}return String(e)};var ft=Object.prototype.hasOwnProperty||function(t){return t in this}},{"./util.inspect":6}],17:[function(t,e){"use strict";var n=t("get-intrinsic"),o=t("call-bind/callBound"),r=t("object-inspect"),i=n("%TypeError%"),a=n("%WeakMap%",!0),s=n("%Map%",!0),c=o("WeakMap.prototype.get",!0),l=o("WeakMap.prototype.set",!0),u=o("WeakMap.prototype.has",!0),p=o("Map.prototype.get",!0),d=o("Map.prototype.set",!0),f=o("Map.prototype.has",!0),h=function(t,e){for(var n,o=t;null!==(n=o.next);o=n)if(n.key===e)return o.next=n.next,n.next=t.next,t.next=n,n},m=function(t,e){var n=h(t,e);return n&&n.value},y=function(t,e,n){var o=h(t,e);o?o.value=n:t.next={key:e,next:t.next,value:n}},g=function(t,e){return!!h(t,e)};e.exports=function(){var t,e,n,o={assert:function(t){if(!o.has(t))throw new i("Side channel does not contain "+r(t))},get:function(o){if(a&&o&&("object"==typeof o||"function"==typeof o)){if(t)return c(t,o)}else if(s){if(e)return p(e,o)}else if(n)return m(n,o)},has:function(o){if(a&&o&&("object"==typeof o||"function"==typeof o)){if(t)return u(t,o)}else if(s){if(e)return f(e,o)}else if(n)return g(n,o);return!1},set:function(o,r){a&&o&&("object"==typeof o||"function"==typeof o)?(t||(t=new a),l(t,o,r)):s?(e||(e=new s),d(e,o,r)):(n||(n={key:{},next:null}),y(n,o,r))}};return o}},{"call-bind/callBound":7,"get-intrinsic":11,"object-inspect":16}]},{},[2])(2)})),OSM.initializeContextMenu=function(t){t.contextmenu.addItem({text:I18n.t("javascripts.context.directions_from"),callback:function(e){var n=OSM.zoomPrecision(t.getZoom()),o=e.latlng.wrap(),r=o.lat.toFixed(n),i=o.lng.toFixed(n);OSM.router.route("/directions?"+Qs.stringify({from:r+","+i,to:$("#route_to").val()}))}}),t.contextmenu.addItem({text:I18n.t("javascripts.context.directions_to"),callback:function(e){var n=OSM.zoomPrecision(t.getZoom()),o=e.latlng.wrap(),r=o.lat.toFixed(n),i=o.lng.toFixed(n);OSM.router.route("/directions?"+Qs.stringify({from:$("#route_from").val(),to:r+","+i}))}}),t.contextmenu.addItem({text:I18n.t("javascripts.context.add_note"),callback:function(e){var n=OSM.zoomPrecision(t.getZoom()),o=e.latlng.wrap(),r=o.lat.toFixed(n),i=o.lng.toFixed(n);OSM.router.route("/note/new?lat="+r+"&lon="+i)}}),t.contextmenu.addItem({text:I18n.t("javascripts.context.show_address"),callback:function(e){var n=OSM.zoomPrecision(t.getZoom()),o=e.latlng.wrap(),r=o.lat.toFixed(n),i=o.lng.toFixed(n);OSM.router.route("/search?whereami=1&query="+encodeURIComponent(r+","+i))}}),t.contextmenu.addItem({text:I18n.t("javascripts.context.query_features"),callback:function(e){var n=OSM.zoomPrecision(t.getZoom()),o=e.latlng.wrap(),r=o.lat.toFixed(n),i=o.lng.toFixed(n);OSM.router.route("/query?lat="+r+"&lon="+i)}}),t.contextmenu.addItem({text:I18n.t("javascripts.context.centre_map"),callback:function(e){t.panTo(e.latlng)}}),t.on("mousedown",(function(e){e.originalEvent.shiftKey?t.contextmenu.disable():t.contextmenu.enable()}));var e=function(){t.contextmenu.setDisabled(2,t.getZoom()<12),t.contextmenu.setDisabled(4,t.getZoom()<14)};t.on("zoomend",e),e()},function(t,e){function n(e){var n,o=t(e.ownerDocument);return{x:(n=(e=t(e)).offset()).left+e.outerWidth()/2-o.scrollLeft(),y:n.top+e.outerHeight()/2-o.scrollTop()}}function o(e){var n,o=t(e.ownerDocument);return{x:(n=(e=t(e)).offset()).left-o.scrollLeft(),y:n.top-o.scrollTop()}}var r=/^key/,i=/^(?:mouse|contextmenu)|click/;t.fn.simulate=function(e,n){return this.each((function(){new t.simulate(this,e,n)}))},t.simulate=function(e,n,o){var r=t.camelCase("simulate-"+n);this.target=e,this.options=o,this[r]?this[r]():this.simulateEvent(e,n,o)},t.extend(t.simulate,{keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},buttonCode:{LEFT:0,MIDDLE:1,RIGHT:2}}),t.extend(t.simulate.prototype,{simulateEvent:function(t,e,n){var o=this.createEvent(e,n);this.dispatchEvent(t,e,o,n)},createEvent:function(t,e){return r.test(t)?this.keyEvent(t,e):i.test(t)?this.mouseEvent(t,e):void 0},mouseEvent:function(n,o){var r,i,a,s;return o=t.extend({bubbles:!0,cancelable:"mousemove"!==n,view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:e},o),document.createEvent?((r=document.createEvent("MouseEvents")).initMouseEvent(n,o.bubbles,o.cancelable,o.view,o.detail,o.screenX,o.screenY,o.clientX,o.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.button,o.relatedTarget||document.body.parentNode),0===r.pageX&&0===r.pageY&&Object.defineProperty&&(i=r.relatedTarget.ownerDocument||document,a=i.documentElement,s=i.body,Object.defineProperty(r,"pageX",{get:function(){return o.clientX+(a&&a.scrollLeft||s&&s.scrollLeft||0)-(a&&a.clientLeft||s&&s.clientLeft||0)}}),Object.defineProperty(r,"pageY",{get:function(){return o.clientY+(a&&a.scrollTop||s&&s.scrollTop||0)-(a&&a.clientTop||s&&s.clientTop||0)}}))):document.createEventObject&&(r=document.createEventObject(),t.extend(r,o),r.button={0:1,1:4,2:2}[r.button]||(-1===r.button?0:r.button)),r},keyEvent:function(n,o){var r;if(o=t.extend({bubbles:!0,cancelable:!0,view:window,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:e},o),document.createEvent)try{(r=document.createEvent("KeyEvents")).initKeyEvent(n,o.bubbles,o.cancelable,o.view,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode)}catch(e){(r=document.createEvent("Events")).initEvent(n,o.bubbles,o.cancelable),t.extend(r,{view:o.view,ctrlKey:o.ctrlKey,altKey:o.altKey,shiftKey:o.shiftKey,metaKey:o.metaKey,keyCode:o.keyCode,charCode:o.charCode})}else document.createEventObject&&(r=document.createEventObject(),t.extend(r,o));return(/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())||"[object Opera]"==={}.toString.call(window.opera))&&(r.keyCode=o.charCode>0?o.charCode:o.keyCode,r.charCode=e),r},dispatchEvent:function(t,e,n){t.dispatchEvent?t.dispatchEvent(n):"click"===e&&t.click&&"input"===t.nodeName.toLowerCase()?t.click():t.fireEvent&&t.fireEvent("on"+e,n)},simulateFocus:function(){function e(){o=!0}var n,o=!1,r=t(this.target);r.bind("focus",e),r[0].focus(),o||((n=t.Event("focusin")).preventDefault(),r.trigger(n),r.triggerHandler("focus")),r.unbind("focus",e)},simulateBlur:function(){function e(){o=!0}var n,o=!1,r=t(this.target);r.bind("blur",e),r[0].blur(),setTimeout((function(){r[0].ownerDocument.activeElement===r[0]&&r[0].ownerDocument.body.focus(),o||((n=t.Event("focusout")).preventDefault(),r.trigger(n),r.triggerHandler("blur")),r.unbind("blur",e)}),1)}}),t.extend(t.simulate.prototype,{simulateDrag:function(){var r=0,i=this.target,a=i.ownerDocument,s=this.options,c="corner"===s.handle?o(i):n(i),l=Math.floor(c.x),u=Math.floor(c.y),p={clientX:l,clientY:u},d=s.dx||(s.x!==e?s.x-l:0),f=s.dy||(s.y!==e?s.y-u:0),h=s.moves||3;for(this.simulateEvent(i,"mousedown",p);r<h;r++)l+=d/h,u+=f/h,p={clientX:Math.round(l),clientY:Math.round(u)},this.simulateEvent(a,"mousemove",p);t.contains(a,i)?(this.simulateEvent(i,"mouseup",p),this.simulateEvent(i,"click",p)):this.simulateEvent(a,"mouseup",p)}})}(jQuery),OSM.Search=function(t){function e(t){t.preventDefault(),t.stopPropagation();var e=$(this).parents(".search_more"),n=$("meta[name=csrf-param]").attr("content"),o=$("meta[name=csrf-token]").attr("content"),r={};$(this).hide(),e.find(".loader").show(),r[n]=o,$.ajax({url:$(this).attr("href"),method:"POST",data:r,success:function(t){e.replaceWith(t)}})}function n(){var t=$(this).data("marker");if(!t){var e=$(this).find("a.set_position").data();t=L.marker([e.lat,e.lon],{icon:OSM.getUserIcon()}),$(this).data("marker",t)}a.addLayer(t),$(this).closest("li").addClass("selected")}function o(){var t=$(this).data("marker");t&&a.removeLayer(t),$(this).closest("li").removeClass("selected")}function r(e){e.minLon&&e.minLat&&e.maxLon&&e.maxLat?t.fitBounds([[e.minLat,e.minLon],[e.maxLat,e.maxLon]]):t.setView([e.lat,e.lon],e.zoom)}function i(t){var e=$(this).data();r(e),e.type&&e.id||(t.preventDefault(),t.stopPropagation())}$(".search_form input[name=query]").on("input",(function(t){""===$(t.target).val()?$(".describe_location").fadeIn(100):$(".describe_location").fadeOut(100)})),$(".search_form a.button.switch_link").on("click",(function(e){e.preventDefault();var n=$(e.target).parent().parent().find("input[name=query]").val();n?OSM.router.route("/directions?from="+encodeURIComponent(n)+OSM.formatHash(t)):OSM.router.route("/directions"+OSM.formatHash(t))})),$(".search_form").on("submit",(function(e){e.preventDefault(),$("header").addClass("closed");var n=$(this).find("input[name=query]").val();n?OSM.router.route("/search?query="+encodeURIComponent(n)+OSM.formatHash(t)):OSM.router.route("/"+OSM.formatHash(t))})),$(".describe_location").on("click",(function(e){e.preventDefault();var n=t.getCenter().wrap(),o=OSM.zoomPrecision(t.getZoom());OSM.router.route("/search?whereami=1&query="+encodeURIComponent(n.lat.toFixed(o)+","+n.lng.toFixed(o)))})),$("#sidebar_content").on("click",".search_more a",e).on("click",".search_results_entry a.set_position",i).on("mouseover","li.search_results_entry:has(a.set_position)",n).on("mouseout","li.search_results_entry:has(a.set_position)",o).on("mousedown","li.search_results_entry:has(a.set_position)",(function(){var t=!1;$(this).one("click",(function(e){t||$(e.target).is("a")||$(this).find("a.set_position").simulate("click",e)})).one("mousemove",(function(){t=!0}))}));var a=L.layerGroup().addTo(t),s={};return s.pushstate=s.popstate=function(t){var e=Qs.parse(t.substring(t.indexOf("?")+1));$(".search_form input[name=query]").val(e.query),$(".describe_location").hide(),OSM.loadSidebarContent(t,s.load)},s.load=function(){return $(".search_results_entry").each((function(e){var n=$(this),o=$("meta[name=csrf-param]").attr("content"),i=$("meta[name=csrf-token]").attr("content"),a={zoom:t.getZoom(),minlon:t.getBounds().getWest(),minlat:t.getBounds().getSouth(),maxlon:t.getBounds().getEast(),maxlat:t.getBounds().getNorth()};a[o]=i,$.ajax({url:n.data("href"),method:"POST",data:a,success:function(t){if(n.html(t),0===e){var o=n.find("*[data-lat][data-lon]:first").first();o.length&&r(o.data())}}})})),t.getState()},s.unload=function(){a.clearLayers(),$(".search_form input[name=query]").val(""),$(".describe_location").fadeIn(100)},s},OSM.initializeBrowse=function(t){function e(){var e=t.getBounds();i&&i.contains(e)||o()}function n(t,e,n,o){$("#browse_status").html($("<div>").append($("<div class='d-flex'>").append($("<h2 class='flex-grow-1 text-break'>").text(I18n.t("browse.start_rjs.load_data")),$("<div>").append($("<button type='button' class='btn-close'>").attr("aria-label",I18n.t("javascripts.close")).click(o))),$("<p class='alert alert-warning'>").text(I18n.t("browse.start_rjs.feature_warning",{num_features:t,max_features:e})),$("<input type='submit' class='btn btn-primary'>").val(I18n.t("browse.start_rjs.load_data")).click(n)))}function o(){var e=t.getBounds(),o="/api/"+OSM.API_VERSION+"/map?bbox="+e.toBBoxString(),r=2e3;a&&a.abort(),a=$.ajax({url:o,success:function(o){function c(){$("#browse_status").empty(),s.addData(u),i=e}function l(){$("#browse_status").empty()}s.clearLayers();var u=s.buildFeatures(o);u.length<r?c():n(u.length,r,c,l),t._objectLayer&&t._objectLayer.bringToFront(),a=null}})}function r(t){OSM.router.route("/"+t.feature.type+"/"+t.feature.id)}var i,a,s=t.dataLayer;s.setStyle({way:{weight:3,color:"#000000",opacity:.4},area:{weight:3,color:"#ff0000"},node:{color:"#00ff00"}}),s.isWayArea=function(){return!1},s.on("click",(function(t){r(t.layer)})),t.on("layeradd",(function(n){n.layer===s&&(t.on("moveend",e),e())})),t.on("layerremove",(function(n){n.layer===s&&(t.off("moveend",e),$("#browse_status").empty())}))},OSM.Export=function(t){function e(){return L.latLngBounds(L.latLng($("#minlat").val(),$("#minlon").val()),L.latLng($("#maxlat").val(),$("#maxlon").val()))}function n(){var n=e();t.fitBounds(n),l.setBounds(n),l.enable(),a()}function o(e){e.preventDefault(),$("#drag_box").hide(),l.setBounds(t.getBounds().pad(-.2)),l.enable(),a()}function r(){i(l.isEnabled()?l.getBounds():t.getBounds()),a()}function i(e){var n=OSM.zoomPrecision(t.getZoom());$("#minlon").val(e.getWest().toFixed(n)),$("#minlat").val(e.getSouth().toFixed(n)),$("#maxlon").val(e.getEast().toFixed(n)),$("#maxlat").val(e.getNorth().toFixed(n)),$("#export_overpass").attr("href","https://overpass-api.de/api/map?bbox="+$("#minlon").val()+","+$("#minlat").val()+","+$("#maxlon").val()+","+$("#maxlat").val())}function a(){$("#export_osm_too_large").toggle(e().getSize()>OSM.MAX_REQUEST_AREA),$("#export_commit").toggle(e().getSize()<OSM.MAX_REQUEST_AREA)}function s(t){e().getSize()>OSM.MAX_REQUEST_AREA&&t.preventDefault()}var c={},l=new L.LocationFilter({enableButton:!1,adjustButton:!1}).on("change",r);return c.pushstate=c.popstate=function(t){$("#export_tab").addClass("current"),OSM.loadSidebarContent(t,c.load)},c.load=function(){return t.addLayer(l).on("moveend",r),$("#maxlat, #minlon, #maxlon, #minlat").change(n),$("#drag_box").click(o),$(".export_form").on("submit",s),r(),t.getState()},c.unload=function(){t.removeLayer(l).off("moveend",r),$("#export_tab").removeClass("current")},c},OSM.initializeNotes=function(t){function e(t,e){var n=t;return n?n.setIcon(a[e.properties.status]):((n=L.marker(e.geometry.coordinates.reverse(),{icon:a[e.properties.status],title:e.properties.comments[0].text,opacity:.8,interactive:!0})).id=e.properties.id,n.addTo(r)),n}function n(){function n(t){function n(t){var n=a[t.properties.id];delete a[t.properties.id],i[t.properties.id]=e(n,t)}var a=i;for(var s in i={},t.features.forEach(n),a)r.removeLayer(a[s]);o=null}var a=t.getBounds();if(a.getSize()<=OSM.MAX_NOTE_REQUEST_AREA){var s="/api/"+OSM.API_VERSION+"/notes.json?bbox="+a.toBBoxString();o&&o.abort(),o=$.ajax({url:s,success:n})}}var o,r=t.noteLayer,i={},a={new:L.icon({iconUrl:OSM.NEW_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),open:L.icon({iconUrl:OSM.OPEN_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),closed:L.icon({iconUrl:OSM.CLOSED_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]})};t.on("layeradd",(function(e){e.layer===r&&(n(),t.on("moveend",n))})).on("layerremove",(function(e){e.layer===r&&(t.off("moveend",n),r.clearLayers(),i={})})),r.on("click",(function(t){t.layer.id&&OSM.router.route("/note/"+t.layer.id)})),r.getLayerId=function(t){return t.id}},OSM.History=function(t){function e(t){var e=p.getLayer(t);e&&e.setStyle({fillOpacity:.3,color:"#FF6600",weight:3}),$("#changeset_"+t).addClass("selected")}function n(t){var e=p.getLayer(t);e&&e.setStyle({fillOpacity:0,color:"#FF9500",weight:2}),$("#changeset_"+t).removeClass("selected")}function o(t,e){$("#changeset_"+t).find("a.changeset_id").simulate("click",e)}function r(t){$("#sidebar_content .changesets").html(t)}function i(t){$("#sidebar_content .changeset_more").replaceWith(t);var e=$("#sidebar_content .changesets ol").first(),n=e.next("ol");n.children().appendTo(e),n.remove()}function a(){var e={list:"1"};if("/history"===window.location.pathname){e.bbox=t.getBounds().wrap().toBBoxString();var n=$('link[type="application/atom+xml"]'),o=n.attr("href").split("?")[0];n.attr("href",o+"?bbox="+e.bbox)}$.ajax({url:window.location.pathname,method:"GET",data:e,success:function(t){r(t),l()}})}function s(t){t.preventDefault(),t.stopPropagation();var e=$(this).parents(".changeset_more");$(this).hide(),e.find(".loader").show(),$.get($(this).attr("href"),(function(t){i(t),l()}))}function c(){p.clearLayers(),d.forEach((function(e){var n=t.project(L.latLng(e.bbox.minlat,e.bbox.minlon)),o=t.project(L.latLng(e.bbox.maxlat,e.bbox.maxlon)),r=o.x-n.x,i=n.y-o.y,a=20;r<a&&(n.x-=(a-r)/2,o.x+=(a-r)/2),i<a&&(n.y+=(a-i)/2,o.y-=(a-i)/2),e.bounds=L.latLngBounds(t.unproject(n),t.unproject(o))})),d.sort((function(t,e){return e.bounds.getSize()-t.bounds.getSize()}));for(var e=0;e<d.length;++e){var n=d[e],o=L.rectangle(n.bounds,{weight:2,color:"#FF9500",opacity:1,fillColor:"#FFFFAF",fillOpacity:0});o.id=n.id,o.addTo(p)}}function l(){if(d=$("[data-changeset]").map((function(t,e){return $(e).data("changeset")})).get().filter((function(t){return t.bbox})),c(),"/history"!==window.location.pathname){var e=p.getBounds();e.isValid()&&t.fitBounds(e)}}var u={};$("#sidebar_content").on("click",".changeset_more a",s).on("mouseover","[data-changeset]",(function(){e($(this).data("changeset").id)})).on("mouseout","[data-changeset]",(function(){n($(this).data("changeset").id)}));var p=L.featureGroup().on("mouseover",(function(t){e(t.layer.id)})).on("mouseout",(function(t){n(t.layer.id)})).on("click",(function(t){o(t.layer.id,t.originalEvent)}));p.getLayerId=function(t){return t.id};var d=[];return u.pushstate=u.popstate=function(t){$("#history_tab").addClass("current"),OSM.loadSidebarContent(t,u.load)},u.load=function(){t.addLayer(p),"/history"===window.location.pathname&&t.on("moveend",a),t.on("zoomend",c),a()},u.unload=function(){t.removeLayer(p),t.off("moveend",a),$("#history_tab").removeClass("current")},u},OSM.Note=function(t){function e(r,a,s){o.find("input[type=submit]").on("click",(function(t){t.preventDefault();var o=$(t.target).data(),i=t.target.form;$(i).find("input[type=submit]").prop("disabled",!0),$.ajax({url:o.url,type:o.method,oauth:!0,data:{text:$(i.text).val()},success:function(){OSM.loadSidebarContent(r,(function(){e(r,a,n)}))}})})),o.find("textarea").on("input",(function(t){var e=t.target.form;""===$(t.target).val()?($(e.close).val($(e.close).data("defaultActionText")),$(e.comment).prop("disabled",!0)):($(e.close).val($(e.close).data("commentActionText")),$(e.comment).prop("disabled",!1))})),o.find("textarea").val("").trigger("input");var c=$(".details").data();c&&t.addObject({type:"note",id:parseInt(a,10),latLng:L.latLng(c.coordinates.split(",")),icon:i[c.status]}),s&&s()}function n(){var e=$(".details").data();if(e){var n=L.latLng(e.coordinates.split(","));window.location.hash&&!window.location.hash.match(/^#?c[0-9]+$/)||OSM.router.withoutMoveListener((function(){t.setView(n,15,{reset:!0})}))}}var o=$("#sidebar_content"),r={},i={new:L.icon({iconUrl:OSM.NEW_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),open:L.icon({iconUrl:OSM.OPEN_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),closed:L.icon({iconUrl:OSM.CLOSED_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]})};return r.pushstate=r.popstate=function(o,r){OSM.loadSidebarContent(o,(function(){e(o,r,(function(){var e=$(".details").data();if(e){var o=L.latLng(e.coordinates.split(","));t.getBounds().contains(o)||n()}}))}))},r.load=function(t,o){e(t,o,n)},r.unload=function(){t.removeObject()},r},OSM.NewNote=function(t){function e(t,e,o){function i(t,e){s.find("textarea").val(""),n(t),r=null,a.removeLayer(e),l.removeClass("active"),OSM.router.route("/note/"+t.properties.id)}var c=t.getLatLng().wrap();t.options.draggable=!1,t.dragging.disable(),$(e).find("input[type=submit]").prop("disabled",!0),$.ajax({url:o,type:"POST",oauth:!0,data:{lat:c.lat,lon:c.lng,text:$(e.text).val()},success:function(e){i(e,t)}})}function n(t){var e=L.marker(t.geometry.coordinates.reverse(),{icon:u[t.properties.status],opacity:.9,interactive:!0});return e.id=t.properties.id,e.addTo(a),e}function o(e,n){var o=i&&t.hasLayer(i);"dragstart"===n&&o?t.removeLayer(i):(o&&t.removeLayer(i),i=L.circleMarker(e,{weight:2.5,radius:20,fillOpacity:.5,color:"#FF6200"}),t.addLayer(i))}var r,i,a=t.noteLayer,s=$("#sidebar_content"),c={},l=$(".control-note .control-button"),u={new:L.icon({iconUrl:OSM.NEW_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),open:L.icon({iconUrl:OSM.OPEN_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]}),closed:L.icon({iconUrl:OSM.CLOSED_NOTE_MARKER,iconSize:[25,40],iconAnchor:[12,40]})};return l.on("click",(function(t){t.preventDefault(),t.stopPropagation(),$(this).hasClass("disabled")||OSM.router.route("/note/new")})),c.pushstate=c.popstate=function(t){OSM.loadSidebarContent(t,(function(){c.load(t)}))},c.load=function(n){function i(t){$(t.target.form.add).prop("disabled",""===$(t.target).val())}if(!l.hasClass("disabled")&&!l.hasClass("active")){l.addClass("active"),t.addLayer(a);var c,p=Qs.parse(n.substring(n.indexOf("?")+1));return c=p.lat&&p.lon?L.latLng(p.lat,p.lon):t.getCenter(),t.panInside(c,{padding:[50,50]}),(r=L.marker(c,{icon:u.new,opacity:.9,draggable:!0})).on("dragstart dragend",(function(t){o(r.getLatLng(),t.type)})),r.addTo(a),o(r.getLatLng()),r.on("remove",(function(){l.removeClass("active")})).on("dragstart",(function(){$(r).stopTime("removenote")})).on("dragend",(function(){s.find("textarea").focus()})),s.find("textarea").on("input",i).focus(),s.find("input[type=submit]").on("click",(function(t){t.preventDefault(),e(r,t.target.form,"/api/0.6/notes.json")})),t.getState()}},c.unload=function(){r&&a.removeLayer(r),i&&t.removeLayer(i),l.removeClass("active")},c},OSM.Directions=function(t){function e(e,n){var o={};return o.marker=L.marker([0,0],{icon:L.icon({iconUrl:n,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowUrl:OSM.MARKER_SHADOW,shadowSize:[41,41]}),draggable:!0,autoPan:!0}),o.marker.on("drag dragend",(function(e){var n="drag"===e.type;n&&!u.draggable||n&&l||(o.setLatLng(e.target.getLatLng()),t.hasLayer(d)&&s(!1,!n))})),e.on("keydown",(function(){e.removeClass("error")})),e.on("change",(function(t){c=!0;var e=t.target.value;o.setValue(e)})),o.setValue=function(t,n){o.value=t,delete o.latlng,e.removeClass("error"),e.val(t),n?o.setLatLng(n):o.getGeocode()},o.getGeocode=function(){if(o.value){o.awaitingGeocode=!0;var n=t.getBounds().toBBoxString();$.getJSON(OSM.NOMINATIM_URL+"search?q="+encodeURIComponent(o.value)+"&format=json&viewbox="+n,(function(t){if(o.awaitingGeocode=!1,o.hasGeocode=!0,0===t.length)return e.addClass("error"),void alert(I18n.t("javascripts.directions.errors.no_place",{place:o.value}));o.setLatLng(L.latLng(t[0])),e.val(t[0].display_name),c&&(c=!1,s(!0,!0))}))}},o.setLatLng=function(n){var r=OSM.zoomPrecision(t.getZoom());e.val(n.lat.toFixed(r)+", "+n.lng.toFixed(r)),o.hasGeocode=!0,o.latlng=n,o.marker.setLatLng(n).addTo(t)},o}function n(t){return t<1e3?I18n.t("javascripts.directions.distance_m",{distance:Math.round(t)}):t<1e4?I18n.t("javascripts.directions.distance_km",{distance:(t/1e3).toFixed(1)}):I18n.t("javascripts.directions.distance_km",{distance:Math.round(t/1e3)})}function o(t){return I18n.t("javascripts.directions.distance_m",{distance:Math.round(t)})}function r(t){var e=Math.round(t/60),n=Math.floor(e/60);return n+":"+((e-=60*n)<10?"0":"")+e}function i(t){return y.findIndex((function(e){return e.id===t}))}function a(t){u=y[t],g.val(t)}function s(e,i){l&&l.abort();for(var a=0;a<2;++a){var s=h[a];s.hasGeocode||s.awaitingGeocode||(s.getGeocode(),c=!0)}if(h[0].awaitingGeocode||h[1].awaitingGeocode)c=!0;else{var m=h[0].latlng,y=h[1].latlng;if(m&&y){$("header").addClass("closed");var g=OSM.zoomPrecision(t.getZoom());OSM.router.replace("/directions?"+Qs.stringify({engine:u.id,route:m.lat.toFixed(g)+","+m.lng.toFixed(g)+";"+y.lat.toFixed(g)+","+y.lng.toFixed(g)})),$("#sidebar_content").html($(".directions_form .loader_copy").html()),t.setSidebarOverlaid(!1),l=u.getRoute([m,y],(function(a,s){if(l=null,a)return t.removeLayer(d),void(i&&$("#sidebar_content").html('<p class="search_results_error">'+I18n.t("javascripts.directions.errors.no_route")+"</p>"));d.setLatLngs(s.line).addTo(t),e&&t.fitBounds(d.getBounds().pad(.05));var c=$("<p>").append(I18n.t("javascripts.directions.distance")+": "+n(s.distance)+". "+I18n.t("javascripts.directions.time")+": "+r(s.time)+".");void 0!==s.ascend&&void 0!==s.descend&&c.append($("<br>"),I18n.t("javascripts.directions.ascend")+": "+o(s.ascend)+". "+I18n.t("javascripts.directions.descend")+": "+o(s.descend)+".");var h=$("<table class='mb-3'>"),m=$("<button type='button' class='btn-close'>").attr("aria-label",I18n.t("javascripts.close"));$("#sidebar_content").empty().append($("<div class='d-flex'>").append($("<h2 class='flex-grow-1 text-break'>").text(I18n.t("javascripts.directions.directions")),$("<div>").append(m)),c,h),s.steps.forEach((function(e){var n=e[0],o=e[1],r=e[2],i=e[3],a=e[4];i=i<5?"":i<200?String(10*Math.round(i/10))+"m":i<1500?String(100*Math.round(i/100))+"m":i<5e3?String(Math.round(i/100)/10)+"km":String(Math.round(i/1e3))+"km";var s=$("<tr class='turn'/>");s.append("<td><div class='direction i"+o+"'/></td> "),s.append("<td class='instruction'>"+r),s.append("<td class='distance'>"+i),s.on("click",(function(){p.setLatLng(n).setContent("<p>"+r+"</p>").openOn(t)})),s.hover((function(){f.setLatLngs(a).addTo(t)}),(function(){t.removeLayer(f)})),h.append(s)})),$("#sidebar_content").append('<p class="text-center">'+I18n.t("javascripts.directions.instructions.courtesy",{link:u.creditline})+"</p>"),m.on("click",(function(){t.removeLayer(d),$("#sidebar_content").html(""),t.setSidebarOverlaid(!0)}))}))}}}var c,l,u,p=L.popup({autoPanPadding:[100,100]}),d=L.polyline([],{color:"#03f",opacity:.3,weight:10}),f=L.polyline([],{color:"#ff0",opacity:.5,weight:12}),h=[e($("input[name='route_from']"),OSM.MARKER_GREEN),e($("input[name='route_to']"),OSM.MARKER_RED)],m=new Date;m.setYear(m.getFullYear()+10);var y=OSM.Directions.engines;y.sort((function(t,e){var n=I18n.t("javascripts.directions.engines."+t.id),o=I18n.t("javascripts.directions.engines."+e.id);return n.localeCompare(o)}));var g=$("select.routing_engines");y.forEach((function(t,e){g.append("<option value='"+e+"'>"+I18n.t("javascripts.directions.engines."+t.id)+"</option>")})),$(".directions_form .reverse_directions").on("click",(function(){var t=h[0].latlng,e=h[1].latlng,n="",o="";t&&(n=t.lat+","+t.lng),e&&(o=e.lat+","+e.lng),OSM.router.route("/directions?"+Qs.stringify({from:$("#route_to").val(),to:$("#route_from").val(),route:o+";"+n}))})),$(".directions_form .btn-close").on("click",(function(e){e.preventDefault();var n=h[0].value;n?OSM.router.route("/?query="+encodeURIComponent(n)+OSM.formatHash(t)):OSM.router.route("/"+OSM.formatHash(t))}));var v=i("fossgis_osrm_car");Cookies.get("_osm_directions_engine")&&(v=i(Cookies.get("_osm_directions_engine"))),a(v),g.on("change",(function(t){u=y[t.target.selectedIndex],Cookies.set("_osm_directions_engine",u.id,{secure:!0,expires:m,path:"/",samesite:"lax"}),s(!0,!0)})),$(".directions_form").on("submit",(function(t){t.preventDefault(),s(!0,!0)})),$(".routing_marker").on("dragstart",(function(t){var e=t.originalEvent.dataTransfer;e.effectAllowed="move";var n={type:$(this).data("type")};if(e.setData("text",JSON.stringify(n)),e.setDragImage){var o=$("<img>").attr("src",$(t.originalEvent.target).attr("src"));e.setDragImage(o.get(0),12,21)}}));var _={};return _.pushstate=_.popstate=function(){$(".search_form").hide(),$(".directions_form").show(),$("#map").on("dragend dragover",(function(t){t.preventDefault()})),$("#map").on("drop",(function(e){e.preventDefault();var n=e.originalEvent,o=JSON.parse(n.dataTransfer.getData("text")).type,r=L.DomEvent.getMousePosition(n,t.getContainer());r.y+=20;var i=t.containerPointToLatLng(r);h["from"===o?0:1].setLatLng(i),s(!0,!0)}));var e=Qs.parse(location.search.substring(1)),n=(e.route||"").split(";"),o=n[0]&&L.latLng(n[0].split(",")),r=n[1]&&L.latLng(n[1].split(","));if(e.engine){var c=i(e.engine);c>=0&&a(c)}h[0].setValue(e.from||"",o),h[1].setValue(e.to||"",r),t.setSidebarOverlaid(!o||!r),s(!0,!0)},_.load=function(){_.pushstate()},_.unload=function(){$(".search_form").show(),$(".directions_form").hide(),$("#map").off("dragend dragover drop"),t.removeLayer(p).removeLayer(d).removeLayer(h[0].marker).removeLayer(h[1].marker)},_},OSM.Directions.engines=[],OSM.Directions.addEngine=function(t,e){("http:"===document.location.protocol||e)&&OSM.Directions.engines.push(t)},OSM.Directions.addEngine(new FOSSGISOSRMEngine("fossgis_osrm_car","car"),!0),OSM.Directions.addEngine(new FOSSGISOSRMEngine("fossgis_osrm_bike","bike"),!0),OSM.Directions.addEngine(new FOSSGISOSRMEngine("fossgis_osrm_foot","foot"),!0),OSM.Directions.addEngine(new FOSSGISValhallaEngine("fossgis_valhalla_car","auto"),!0),OSM.Directions.addEngine(new FOSSGISValhallaEngine("fossgis_valhalla_bicycle","bicycle"),!0),OSM.Directions.addEngine(new FOSSGISValhallaEngine("fossgis_valhalla_foot","pedestrian"),!0),OSM.Directions.addEngine(new GraphHopperEngine("graphhopper_car","car"),!0),OSM.Directions.addEngine(new GraphHopperEngine("graphhopper_bicycle","bike"),!0),OSM.Directions.addEngine(new GraphHopperEngine("graphhopper_foot","foot"),!0),OSM.Changeset=function(t){function e(e,n){t.addObject({type:"changeset",id:parseInt(e,10)},(function(e){window.location.hash||!e.isValid()||!n&&t.getBounds().contains(e)||OSM.router.withoutMoveListener((function(){t.fitBounds(e)}))}))}function n(t,e,n,o){var r;$(t).find("input[type=submit]").prop("disabled",!0),r=o?{text:$(t.text).val()}:{},$.ajax({url:n,type:e,oauth:!0,data:r,success:function(){OSM.loadSidebarContent(window.location.pathname,i.load)}})}function o(){a.find("input[name=comment]").on("click",(function(t){t.preventDefault();var e=$(t.target).data();n(t.target.form,e.method,e.url,!0)})),a.find(".action-button").on("click",(function(t){t.preventDefault();var e=$(t.target).data();n(t.target.form,e.method,e.url)})),a.find("textarea").on("input",(function(t){var e=t.target.form;""===$(t.target).val()?$(e.comment).prop("disabled",!0):$(e.comment).prop("disabled",!1)})),a.find("textarea").val("").trigger("input")}var r,i={},a=$("#sidebar_content");return i.pushstate=i.popstate=function(t,e){OSM.loadSidebarContent(t,(function(){i.load(t,e)}))},i.load=function(t,n){n&&(r=n),o(),e(r,!0)},i.unload=function(){t.removeObject()},i},OSM.Query=function(t){function e(){var e=$(this).data("geometry");e&&t.addLayer(e),$(this).addClass("selected")}function n(){var e=$(this).data("geometry");e&&t.removeLayer(e),$(this).removeClass("selected")}function o(t){if(t.tags)for(var e in t.tags)if(g.indexOf(e)<0)return!0;return!1}function r(t){var e=t.tags,n="";if("administrative"===e.boundary&&e.admin_level)n=I18n.t("geocoder.search_osm_nominatim.admin_levels.level"+e.admin_level,{defaultValue:I18n.t("geocoder.search_osm_nominatim.prefix.boundary.administrative")});else{var o,r,i=I18n.t("geocoder.search_osm_nominatim.prefix");for(o in e)if(r=e[o],i[o]&&i[o][r])return i[o][r];for(o in e){if(r=e[o],
i[o])return r.slice(0,1).toUpperCase()+r.slice(1).replace(/_/g," ")}}return n||(n=I18n.t("javascripts.query."+t.type)),n}function i(t){for(var e=t.tags,n=I18n.locales.get(),o=0;o<n.length;o++)if(e["name:"+n[o]])return e["name:"+n[o]];return e.name?e.name:e.ref?e.ref:e["addr:housename"]?e["addr:housename"]:e["addr:housenumber"]&&e["addr:street"]?e["addr:housenumber"]+" "+e["addr:street"]:"#"+t.id}function a(t){var e;return"node"===t.type&&t.lat&&t.lon?e=L.circleMarker([t.lat,t.lon],v):"way"===t.type&&t.geometry&&t.geometry.length>0?e=L.polyline(t.geometry.filter((function(t){return null!==t})).map((function(t){return[t.lat,t.lon]})),v):"relation"===t.type&&t.members&&(e=L.featureGroup(t.members.map(a).filter((function(t){return void 0!==t})))),e}function s(t,e,n,s,c,l){var u=s.find("ul");u.empty(),s.show(),s.data("ajax")&&s.data("ajax").abort(),s.data("ajax",$.ajax({url:h,method:"POST",data:{data:"[timeout:10][out:json];"+n},xhrFields:{withCredentials:m},success:function(t){var e;s.find(".loader").hide(),c?(e=t.elements.reduce((function(t,e){var n=e.type+e.id;return"geometry"in e&&delete e.bounds,t[n]=$.extend({},t[n],e),t}),{}),e=Object.keys(e).map((function(t){return e[t]}))):e=t.elements,l&&(e=e.sort(l));for(var n=0;n<e.length;n++){var p=e[n];if(o(p)){var d=$("<li>").addClass("query-result list-group-item").data("geometry",a(p)).text(r(p)+" ").appendTo(u);$("<a>").attr("href","/"+p.type+"/"+p.id).text(i(p)).appendTo(d)}}t.remark&&$("<li>").addClass("query-result list-group-item").text(I18n.t("javascripts.query.error",{server:h,error:t.remark})).appendTo(u),0===u.find("li").length&&$("<li>").addClass("query-result list-group-item").text(I18n.t("javascripts.query.nothing_found")).appendTo(u)},error:function(t,e,n){s.find(".loader").hide(),$("<li>").addClass("query-result list-group-item").text(I18n.t("javascripts.query."+e,{server:h,error:n})).appendTo(u)}}))}function c(t,e){return(t.bounds.maxlon-t.bounds.minlon)*(t.bounds.maxlat-t.bounds.minlat)-(e.bounds.maxlat-e.bounds.minlat)*(e.bounds.maxlat-e.bounds.minlat)}function l(e,n){var o=L.latLng(e,n).wrap(),r=t.getBounds().wrap(),i=OSM.zoomPrecision(t.getZoom()),a=r.getSouth().toFixed(i)+","+r.getWest().toFixed(i)+","+r.getNorth().toFixed(i)+","+r.getEast().toFixed(i),l=10*Math.pow(1.5,19-t.getZoom()),u="around:"+l+","+e+","+n,p="("+("node("+u+")")+";"+("way("+u+")")+";);out tags geom("+a+");"+("relation("+u+")")+";out geom("+a+");",d="is_in("+e+","+n+")->.a;way(pivot.a);out tags bb;out ids geom("+a+");relation(pivot.a);out tags bb;";$("#sidebar_content .query-intro").hide(),f&&t.removeLayer(f),f=L.circle(o,l,v).addTo(t),$(document).everyTime(75,"fadeQueryMarker",(function(e){10===e?t.removeLayer(f):f.setStyle({opacity:1-.1*e,fillOpacity:.5-.05*e})}),10),s(o,l,p,$("#query-nearby"),!1),s(o,l,d,$("#query-isin"),!0,c)}function u(e){var n=OSM.zoomPrecision(t.getZoom()),o=e.latlng.wrap(),r=o.lat.toFixed(n),i=o.lng.toFixed(n);OSM.router.route("/query?lat="+r+"&lon="+i)}function p(){y.addClass("active"),t.on("click",u),$(t.getContainer()).addClass("query-active")}function d(){f&&t.removeLayer(f),$(t.getContainer()).removeClass("query-active").removeClass("query-disabled"),t.off("click",u),y.removeClass("active")}var f,h=OSM.OVERPASS_URL,m=OSM.OVERPASS_CREDENTIALS,y=$(".control-query .control-button"),g=["source","source_ref","source:ref","history","attribution","created_by","tiger:county","tiger:tlid","tiger:upload_uuid","KSJ2:curve_id","KSJ2:lat","KSJ2:lon","KSJ2:coordinate","KSJ2:filename","note:ja"],v={color:"#FF6200",weight:4,opacity:1,fillOpacity:.5,interactive:!1};y.on("click",(function(t){t.preventDefault(),t.stopPropagation(),y.hasClass("active")?d():y.hasClass("disabled")||p()})).on("disabled",(function(){y.hasClass("active")&&(t.off("click",u),$(t.getContainer()).removeClass("query-active").addClass("query-disabled"),$(this).tooltip("show"))})).on("enabled",(function(){y.hasClass("active")&&(t.on("click",u),$(t.getContainer()).removeClass("query-disabled").addClass("query-active"),$(this).tooltip("hide"))})),$("#sidebar_content").on("mouseover",".query-results li.query-result",e).on("mouseout",".query-results li.query-result",n).on("mousedown",".query-results li.query-result",(function(){var e=!1;$(this).one("click",(function(n){if(!e){var o=$(this).data("geometry");o&&t.removeLayer(o),$(n.target).is("a")||$(this).find("a").simulate("click",n)}})).one("mousemove",(function(){e=!0}))}));var _={};return _.pushstate=_.popstate=function(t){OSM.loadSidebarContent(t,(function(){_.load(t,!0)}))},_.load=function(e,n){var o=Qs.parse(e.substring(e.indexOf("?")+1)),r=L.latLng(o.lat,o.lon);window.location.hash||n||t.getBounds().contains(r)||OSM.router.withoutMoveListener((function(){t.setView(r,15)})),l(o.lat,o.lon)},_.unload=function(t){t||(d(),$("#sidebar_content .query-results li.query-result.selected").each(n))},_},OSM.Router=function(t,e){function n(t,e){var n=new RegExp("^"+t.replace(o,"\\$&").replace(r,"(?:$1)?").replace(i,(function(t,e){return e?t:"([^/]+)"})).replace(a,"(.*?)")+"(?:\\?.*)?$"),s={match:function(t){return n.test(t)},run:function(t,o){var r=[];return o&&(r=n.exec(o).map((function(t,e){return e>0&&t?decodeURIComponent(t):t}))),r=r.concat(Array.prototype.slice.call(arguments,2)),(e[t]||$.noop).apply(e,r)}};return s}var o=/[-{}[\]+?.,\\^$|#\s]/g,r=/\((.*?)\)/g,i=/(\(\?)?:\w+/g,a=/\*\w+/g,s=[];for(var c in e)s.push(new n(c,e[c]));s.recognize=function(t){for(var e=0;e<this.length;e++)if(this[e].match(t))return this[e]};var l=window.location.pathname.replace(/(.)\/$/,"$1")+window.location.search,u=s.recognize(l),p=location.hash||OSM.formatHash(t),d={};return $(window).on("popstate",(function(e){if(e.originalEvent.state){var n=window.location.pathname+window.location.search,o=s.recognize(n);n!==l&&(u.run("unload",null,o===u),l=n,(u=o).run("popstate",l),t.setState(e.originalEvent.state,{animate:!1}))}})),d.route=function(e){var n=e.replace(/#.*/,""),o=s.recognize(n);if(!o)return!1;u.run("unload",null,o===u);var r=OSM.parseHash(e);return t.setState(r),window.history.pushState(r,document.title,e),l=n,(u=o).run("pushstate",l),!0},d.replace=function(t){window.history.replaceState(OSM.parseHash(t),document.title,t)},d.stateChange=function(t){t.center?window.history.replaceState(t,document.title,OSM.formatHash(t)):window.history.replaceState(t,document.title,window.location)},d.updateHash=function(){var e=OSM.formatHash(t);e!==p&&(p=e,d.stateChange(OSM.parseHash(e)))},d.hashUpdated=function(){var e=location.hash;if(e!==p){p=e;var n=OSM.parseHash(e);t.setState(n),d.stateChange(n,e)}},d.withoutMoveListener=function(e){function n(){t.off("moveend",d.updateHash),t.once("moveend",(function(){t.on("moveend",d.updateHash)}))}t.once("movestart",n),e(),t.off("movestart",n)},d.load=function(){var t=u.run("load",l);d.stateChange(t||{})},d.setCurrentPath=function(t){l=t,u=s.recognize(l)},t.on("moveend baselayerchange overlaylayerchange",d.updateHash),$(window).on("hashchange",d.hashUpdated),d};